<!--
  Copyright 2016 Goldman Sachs.
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
  -->
<!--Portions copyright Hiroshi Ito. Licensed under Apache 2.0 license-->

<project name="reladomo" default="all" xmlns:jacoco="antlib:org.jacoco.ant">
    <property environment="env"/>
    <property name="jdk.home" value="${env.JDK_HOME}"/>
    <property name="root" value="${env.RELADOMO_HOME}"/>
    <!--todo: remove-->
    <property name="mithra.home" value="${env.RELADOMO_HOME}/reladomo"/>
    <property name="mithra.generateEcListMethod" value="true"/>

    <property name="eclipse-collections.version" value="7.1.1"/>
    <property name="junit.version" value="4.11"/>
    <property name="slf4j.version" value="1.6.4"/>
    <property name="jtdsjbcp.version" value="1.2.0.15"/>
    <property name="fw-psp.version" value="1.3.0"/>
    <property name="gsintegrator-api.version" value="1.8.0"/>
    <property name="antjar.version" value="1.7.1"/>
    <property name="docbook-xsl.version" value="1.79.1"/>
    <property name="jacoco.version" value="0.7.9"/>
    <property name="gwt.version" value="2.6.1"/>

    <property name="mithra.pom-template.dir" location="${mithra.home}/build/mithra/pom-templates"/>
    <property name="mithra.jars.dir" location="${mithra.home}/build/jars/mithra"/>
    <property name="mithra.classes.dir" location="${mithra.home}/classes"/>
    <property name="reladomo.generateConcreteClasses" value="${env.GENERATE_MITHRA_CONCRETE_CLASSES}"/>
    <property name="gwt.compile.output.dir" value="${root}/reladomoui/target/gwtcache"/>


    <import file="${root}/build/reladomo-config.xml"/>

    <fileset dir="${root}/build/lib" id="fileset.build.lib">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/test" id="fileset.lib.test">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/compile" id="fileset.lib.compile">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/drivers" id="fileset.lib.drivers">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/gsapi" id="fileset.lib.gsapi">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/ui" id="fileset.lib.ui">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/graphql" id="fileset.lib.graphql">
        <include name="**/*.jar"/>
    </fileset>

    <path id="reladomo.compile.classpath">
        <fileset refid="fileset.lib.compile"/>
        <pathelement location="${root}/reladomo/target/reladomo-asm-4.2.jar"/>
    </path>

    <path id="reladomographql.compile.classpath">
        <pathelement location="${root}/reladomo/target/classes"/>
        <fileset refid="fileset.lib.graphql"/>
    </path>

    <path id="reladomo.test.compile.classpath">
        <fileset refid="fileset.lib.test"/>
        <path refid="reladomo.compile.classpath"/>
        <pathelement location="${root}/reladomo/target/classes"/>
    </path>

    <path id="reladomographql.test.compile.classpath">
        <fileset refid="fileset.lib.test"/>
        <path refid="reladomo.compile.classpath"/>
        <path refid="reladomographql.compile.classpath"/>
        <pathelement location="${root}/lib/test/jsonassert-1.5.0.jar"/>
        <pathelement location="${root}/lib/test/android-json-0.0.20131108.vaadin1.jar"/>
    </path>

    <path id="reladomo.run.test.classpath">
        <path refid="reladomo.test.classpath"/>
        <pathelement location="${root}/reladomo/target/classes"/>
        <pathelement location="${root}/reladomo/target/test-util-classes"/>
        <pathelement location="${root}/reladomo/src/test/resources"/>
        <pathelement location="${root}/reladomogen/target/classes"/>
        <pathelement location="${root}/reladomogenutil/target/classes"/>
        <pathelement location="${root}/reladomogenutil/target/test-classes"/>
    </path>

    <path id="reladomo.genutil.run.classpath">
        <path refid="reladomo.run.test.classpath"/>
        <fileset refid="fileset.lib.drivers"/>
    </path>

    <path id="reladomogen.compile.classpath">
        <pathelement location="${root}/lib/compile/slf4j-api-${slf4j.version}.jar"/>
    </path>

    <path id="reladomo.test.classpath">
        <fileset refid="fileset.lib.compile"/>
        <fileset refid="fileset.lib.test"/>
        <fileset refid="fileset.lib.drivers"/>
    </path>

    <path id="fop.classpath">
        <fileset dir="${root}/build/lib/fop">
            <include name="**/*.jar"/>
        </fileset>
    </path>

    <path id="xslt.processor.classpath">
        <fileset dir="${root}/build/lib/xalan">
            <include name="**/*.jar"/>
        </fileset>
    </path>

    <path id="reladomogen.classpath">
        <pathelement path="${root}/reladomogen/target/classes"/>
        <pathelement location="${root}/lib/compile/slf4j-api-${slf4j.version}.jar"/>
        <pathelement location="${root}/lib/test/slf4j-log4j12-${slf4j.version}.jar"/>
    </path>

    <path id="gwt.compile.class.path">
        <pathelement location="${root}/reladomoui/src/main/java" />
        <pathelement location="${root}/reladomoui/src/main/web" />
        <fileset refid="fileset.lib.ui"/>
    </path>

    <macrodef name="libboot">
        <attribute name="specFile" />
        <sequential>
            <java failonerror="true" dir="${root}" classpath="${root}/libboot/target/classes" classname="org.libboot.Libboot" fork="true">
                <arg value="download" />
                <arg value="@{specFile}" />
                <arg value="build/repos.txt" />
            </java>
        </sequential>
    </macrodef>

    <macrodef name="gwtcompile">
        <attribute name="module" />
        <attribute name="classpathref" default="gwt.compile.class.path"/>
        <attribute name="output" />
        <sequential>
            <delete quiet="true" dir="@{output}"/>
            <mkdir dir="@{output}"/>
            <java failonerror="true" classpathref="@{classpathref}" classname="com.google.gwt.dev.Compiler" fork="true">
                <jvmarg value="-Djava.awt.headless=true"/>
                <arg value="-war" />
                <arg value="@{output}" />
                <arg value="@{module}" />
            </java>
        </sequential>
    </macrodef>

    <taskdef name="xsd2bean-gen" classname="com.gs.fw.common.freyaxml.generator.ant.FreyaAntTask" loaderRef="freyaXmlGenerator"/>

    <target name="clean-reladomo" >
        <delete quiet="true" dir="${root}/target"/>
        <delete quiet="true" dir="${root}/reladomo/target"/>
        <delete quiet="true" dir="${root}/reladomogen/target"/>
        <delete quiet="true" dir="${root}/reladomographql/target"/>
        <delete quiet="true" dir="${root}/reladomoui/target"/>
        <delete quiet="true" dir="${root}/reladomogs.target"/>
    </target>

    <target name="clean" depends="clean-reladomo" description="Delete class files and other temp files"/>  <!-- standard alias -->

    <target name="all" depends="compile-reladomo, compile-reladomo-genutil"/>

    <target name="sanity-check-build">
        <available property="jdk.sanity.check" classname="java.sql.Connection" ignoresystemclasses="true">
            <classpath>
                <fileset dir="${jdk.home}" includes="**/*.jar"/>
            </classpath>
        </available>
        <fail message="Could not find the JDK! Check ${jdk.home}." unless="jdk.sanity.check"/>
        <available property="reladomo.sanity.check" file="${root}/reladomo/src/main/java/com/gs/fw/common/mithra/MithraManager.java"/>
        <fail message="Could not find Reladomo sources. Project root is ${root}, but there is nothing in ${root}/reladomo/src/main/java/com/gs/fw/common/mithra/MithraManager.java." unless="reladomo.sanity.check"/>
    </target>

    <target name="determine-jdk">
        <available property="jdk14" classname="java.sql.Savepoint" ignoresystemclasses="true">
            <classpath>
                <pathelement location="${jdk.home}/jre/lib/rt.jar"/>
            </classpath>
        </available>
    </target>

    <target name="init-reladomo" depends="determine-jdk, sanity-check-build">
        <tstamp/>
        <mkdir dir="${root}/target"/>
        <mkdir dir="${root}/reladomo/target"/>
        <mkdir dir="${root}/reladomo/target/depend"/>
        <mkdir dir="${root}/reladomo/target/classes"/>
        <mkdir dir="${root}/reladomo/target/test-util-classes"/>
        <mkdir dir="${root}/reladomo/target/test-classes-offheap"/>
        <mkdir dir="${root}/reladomo/target/test-classes-onheap"/>
        <mkdir dir="${root}/reladomo/target/generated-src"/>
        <mkdir dir="${root}/reladomo/target/test-generated-offheap-src"/>
        <mkdir dir="${root}/reladomo/target/test-generated-onheap-src"/>
        <mkdir dir="${root}/reladomo/target/dbtemp"/>
        <mkdir dir="${root}/reladomo/target/docbook"/>
        <mkdir dir="${root}/reladomo/target/docbook-lib"/>
        <mkdir dir="${root}/reladomo/target/javadoc"/>
        <mkdir dir="${root}/reladomo/target/xsddoc"/>
        <mkdir dir="${root}/reladomo/target/test-util-javadoc"/>
        <mkdir dir="${root}/reladomogen/target"/>
        <mkdir dir="${root}/reladomogen/target/javadoc"/>
        <mkdir dir="${root}/reladomogen/target/classes"/>
        <mkdir dir="${root}/reladomogen/target/depend"/>
        <mkdir dir="${root}/reladomogenutil/target"/>
        <mkdir dir="${root}/reladomogenutil/target/classes"/>
        <mkdir dir="${root}/reladomogenutil/target/test-classes"/>
        <mkdir dir="${root}/reladomogenutil/target/depend"/>
        <mkdir dir="${root}/reladomogenutil/target/db/mssql"/>
        <mkdir dir="${root}/reladomogenutil/target/db/sybase"/>
        <mkdir dir="${root}/reladomogenutil/target/db/db2"/>
        <mkdir dir="${root}/reladomogenutil/target/db/postgres"/>
        <mkdir dir="${root}/reladomogenutil/target/db/oracle"/>
        <mkdir dir="${root}/reladomogsi/target"/>
        <mkdir dir="${root}/reladomogsi/target/generated-src"/>
        <mkdir dir="${root}/reladomogsi/target/classes"/>
        <mkdir dir="${root}/reladomogsi/target/depend"/>
        <mkdir dir="${root}/reladomoui/target"/>
        <mkdir dir="${root}/reladomogs/target"/>
        <mkdir dir="${root}/reladomogs/target/classes"/>
        <mkdir dir="${root}/reladomogs/target/depend"/>
        <mkdir dir="${root}/reladomoui/target"/>
        <mkdir dir="${gwt.compile.output.dir}"/>
        <mkdir dir="${root}/reladomoui/target/classes"/>
        <mkdir dir="${root}/reladomoui/target/depend"/>
    </target>

    <target name="generate-mithra-query-parser" depends="init-reladomo">
        <mkdir dir="${root}/reladomo/target/grammar/com/gs/fw/common/mithra/generator/queryparser"/>
        <property name="mithra.queryparser.dir" location="${root}/reladomo/target/grammar/com/gs/fw/common/mithra/generator/queryparser"/>
        <jjtree
            target="${root}/reladomo/src/main/grammar/mithra.jjt"
            outputdirectory="${mithra.queryparser.dir}"
            javacchome="${mithra.home}/build/javacc-3.2"
            static="false"
            visitor="true"
            multi="true"
            />
        <javacc
            target="${mithra.queryparser.dir}/mithra.jj"
            outputdirectory="${mithra.queryparser.dir}"
            javacchome="${mithra.home}/build/javacc-3.2"
            static="false"
            />
        <delete quiet="true">
            <fileset dir="${mithra.queryparser.dir}" includes="*.jj"/>
        </delete>
    </target>

    <target name="mithra-vendor-test-suite" depends="reladomo-vendor-junitreport, generate-reladomo-xml-test" description="Run JUnit Vendor test cases">
        <fail if="failed.mithra.unit.tests" message="Reladomo unit tests failed"/>
    </target>


    <macrodef name="exec-test-suite">
        <attribute name="mithraxmlconfig" description="mithra.xml.config"/>
        <attribute name="testclass" description="test class"/>
        <attribute name="qualifier" description="added to the end of the test name" default=""/>
        <attribute name="heap" description="either 'onheap' or 'offheap"/>
        <sequential>
            <delete dir="${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
            <mkdir dir="${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
            <mkdir dir="${root}/reladomo/target/testresult"/>
            <junit printsummary="off" dir="${root}" timeout="3600000" fork="yes" failureproperty="failed.mithra.unit.tests"
                   includeantruntime="true" showoutput="false">
                <formatter type="xml" extension="@{mithraxmlconfig}"/>
                <!--<formatter type="plain" usefile="false"/>-->
                <formatter classname="com.gs.fw.common.mithra.test.JunitFormatter" extension="@{mithraxmlconfig}.txt"/>
                <classpath>
                    <path refid="reladomo.run.test.classpath"/>
                    <pathelement location="${root}/reladomo/target/test-classes-@{heap}"/>
                </classpath>
                <jvmarg value="-server"/>
                <jvmarg value="${jacocovmarg}${root}/reladomo/target/coverage/@{mithraxmlconfig}@{testclass}@{heap}.exec"/>
                <jvmarg value="-Xmx3048m"/>
                <jvmarg value="-ea"/>
                <jvmarg value="-Dlog4j.configuration=file:${root}/reladomo/src/test/resources/log4jWarn.config"/>
                <jvmarg value="-Dmithra.xml.root=${root}/reladomo/src/test/resources/"/>
                <jvmarg value="-Dmithra.xml.config=@{mithraxmlconfig}"/>
                <jvmarg value="-Djacoco.args=${jacocovmarg}${root}/reladomo/target/coverage/jacoco/@{mithraxmlconfig}@{testclass}@{heap}.exec"/>
                <jvmarg value="-Dderby.storage.tempDirectory=${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
                <jvmarg value="-Dderby.system.home=${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
                <jvmarg value="-Dderby.system.durability=test"/>
                <jvmarg value="-Duser.timezone=America/New_York"/>
                <test name="@{testclass}" todir="${root}/reladomo/target/testresult"/>
            </junit>
            <replace casesensitive="true" dir="${root}/reladomo/target/testresult" includes="TEST-@{testclass}@{mithraxmlconfig}">
                <replacefilter token="&quot; tests=" value="@{qualifier}&quot; tests="/>
            </replace>
            <replaceregexp file="${root}/reladomo/target/testresult/TEST-@{testclass}@{mithraxmlconfig}"
                           match="classname=&quot;(.*)\.([abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$1234567890]*)&quot; name=&quot;(.*)&quot; time"
                           replace="classname=&quot;\1.\2&quot; name=&quot;\2.\3@{qualifier}&quot; time"
                           byline="true"/>
        </sequential>
    </macrodef>
    <fileset dir="${root}/reladomo/src/main/java" id="coverage-src">
        <exclude name="**/xmlbinding/**/*.java"/>
        <exclude name="**/notification/RunsMasterQueue*.java"/>
        <include name="**/*.java"/>
    </fileset>

    <fileset dir="${root}/reladomo/target/classes" id="class">
        <exclude name="com/gs/mithra/asm/**/*.class"/>
        <exclude name="**/test/**/*.class"/>
        <exclude name="**/generator/**/*.class"/>
        <exclude name="**/ui/**/*.class"/>
        <exclude name="**/templates/**/*.class"/>
        <exclude name="**/xmlbinding/**/*.class"/>
        <exclude name="**/notification/RunsMasterQueue*.class"/>
    </fileset>

    <target name="-jacoco-init">
        <unzip src="${root}/lib/coverage/org.jacoco.agent-${jacoco.version}.jar" dest="${root}/lib/coverage"/>
        <property name="jacocovmarg" value="-javaagent:${root}/lib/coverage/jacocoagent.jar=excludes=com.gs.fw.common.mithra.generator.*:
                                  com.gs.fw.common.mithra.test.*:
                                  com.gs.mithra.asm.*:
                                  com.gs.fw.common.mithra.ui.*:
                                  com.gs.fw.common.mithra.templates.*:
                                  com.gs.fw.common.mithra.cacheloader.xmlbinding.*:
                                  com.gs.fw.common.mithra.notification.RunsMasterQueue*:
                                  com.gs.fw.common.mithra.gsintegrator.IntegratorDataSequence*:
                                  com.gs.fw.common.mithra.xmlbinding.*,destfile="/>
        <taskdef uri="antlib:org.jacoco.ant" resource="org/jacoco/ant/antlib.xml">
            <classpath path="${root}/lib/coverage/org.jacoco.ant-${jacoco.version}.jar"/>
            <classpath path="${root}/lib/coverage/org.jacoco.core-${jacoco.version}.jar"/>
            <classpath path="${root}/lib/coverage/org.jacoco.report-${jacoco.version}.jar"/>
            <classpath path="${root}/lib/coverage/asm-debug-all-5.2.jar"/>
        </taskdef>
    </target>

    <!-- ************************** reladomogen **********************************-->
    <target name="xsd2bean-reladomo-generator">
        <xsd2bean-gen parserName="MithraGenerator"
            destinationPackage="com.gs.fw.common.mithra.generator.metamodel"
            xsd="${root}/reladomogen/src/main/xsd/mithraobject.xsd"
            generatedDir="${root}/reladomogen/target/generated-src"
            nonGeneratedDir="${root}/reladomogen/src/main/java"
            >
        </xsd2bean-gen>
    </target>
    <target name="gen-reladomogen-version-class" depends="init-reladomo">

        <dependset>
            <srcfileset
                dir="${root}/build"
                includes="mithra-config.xml"/>
            <targetfileset
                dir="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/generator"
                includes="MithraVersion.java"/>
        </dependset>

        <copy file="${root}/reladomogen/src/main/templates/MithraVersion.tmpl"
              toFile="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/generator/MithraVersion.java">
        </copy>
        <replace casesensitive="true" dir="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/generator" includes="MithraVersion.java">
            <replacefilter token="%PACKAGE_NAME%" value="com.gs.fw.common.mithra.generator"/>
        </replace>
        <replace casesensitive="true" dir="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/generator" includes="MithraVersion.java">
            <replacefilter token="%MITHRA_VERSION_STRING%" value="${reladomo.version}"/>
        </replace>
        <replace casesensitive="true" dir="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/generator" includes="MithraVersion.java">
            <replacefilter token="%MITHRA_VERSION%" value="${reladomo.version}"/>
        </replace>
        <replaceregexp file="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/generator/MithraVersion.java"
                         match="=[ ]*([0-9]+).([0-9]+).([0-9]+)"  replace="= \1 &lt;&lt; 16 | \2 &lt;&lt; 8 | \3"/>

        <dependset>
            <srcfileset
                dir="${root}/build"
                includes="mithra-config.xml"/>
            <targetfileset
                dir="${root}/reladomo/target/generated-src/com/gs/fw/common/mithra/util"
                includes="MithraVersion.java"/>
        </dependset>

        <copy file="${root}/reladomogen/src/main/templates/MithraVersion.tmpl"
              toFile="${root}/reladomo/target/generated-src/com/gs/fw/common/mithra/util/MithraVersion.java">
        </copy>
        <replace casesensitive="true" dir="${root}/reladomo/target/generated-src/com/gs/fw/common/mithra/util" includes="MithraVersion.java">
            <replacefilter token="%PACKAGE_NAME%" value="com.gs.fw.common.mithra.util"/>
        </replace>
        <replace casesensitive="true" dir="${root}/reladomo/target/generated-src/com/gs/fw/common/mithra/util" includes="MithraVersion.java">
            <replacefilter token="%MITHRA_VERSION%" value="${reladomo.version}"/>
        </replace>
        <replace casesensitive="true" dir="${root}/reladomo/target/generated-src/com/gs/fw/common/mithra/util" includes="MithraVersion.java">
            <replacefilter token="%MITHRA_VERSION_STRING%" value="${reladomo.version}"/>
        </replace>
        <replaceregexp file="${root}/reladomo/target/generated-src/com/gs/fw/common/mithra/util/MithraVersion.java"
                       match="=[ ]*([0-9]+).([0-9]+).([0-9]+)"  replace="= \1 &lt;&lt; 16 | \2 &lt;&lt; 8 | \3"/>
    </target>

    <target name="check-template-generation" depends="init-reladomo">
        <uptodate property="template-generation.notRequired" targetfile="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/templates/readonly/Abstract_jsp.java" >
          <srcfiles dir= "${root}/reladomogen/src/main/templates" includes="**/*"/>
        </uptodate>
    </target>

    <target name="generate-templates" depends="check-template-generation" unless="template-generation.notRequired">
        <taskdef name="jasper2" classname="org.apache.jasper.JspC" loaderRef="jasper"/>
        <mkdir dir="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/templates"/>
        <delete quiet="true">
            <fileset dir="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/templates" includes="**/*.java" />
        </delete>
        <jasper2 outputDir="${root}/reladomogen/target/generated-src"
            uriRoot="${root}/reladomogen/src/main/templates"
            package="com.gs.fw.common.mithra.templates"
            listErrors="true"
            verbose="0"
            compile="false">
        </jasper2>
        <javac destdir="${root}/reladomogen/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            includeAntRuntime="true">
            <src path="${root}/reladomogen/src/main/java"/>
            <include name="com/gs/fw/common/mithra/generator/TemplateMinifier.java"/>
            <include name="com/gs/fw/common/mithra/generator/SourceFormatter.java"/>
        </javac>
        <java
                classname="com.gs.fw.common.mithra.generator.TemplateMinifier"
                fork="true"
                failonerror="true"
                maxmemory="128m"
                >
            <arg value="${root}/reladomogen/target/generated-src/com/gs/fw/common/mithra/templates"/>
            <classpath>
                <pathelement path="${root}/reladomogen/target/classes"/>
            </classpath>
        </java>
    </target>

    <target name="compile-reladomo-generator" depends="init-reladomo, gen-reladomogen-version-class, xsd2bean-reladomo-generator, generate-templates">
        <dependset>
            <srcfileset dir="${root}/reladomogen/src/main/java"/>
            <srcfileset dir="${root}/reladomogen/target/generated-src"/>
            <targetfileset dir="${root}/reladomogen/target/classes"/>
        </dependset>
        <javac destdir="${root}/reladomogen/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            includeAntRuntime="true">
            <src path="${root}/reladomogen/target/generated-src"/>
            <include name="com/gs/fw/common/mithra/generator/MithraVersion.java"/>
        </javac>
        <javac destdir="${root}/reladomogen/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            nowarn="true"
            includeAntRuntime="true">
            <src path="${root}/reladomogen/src/main/java"/>
            <src path="${root}/reladomogen/target/generated-src"/>
            <classpath>
                <path refid="reladomogen.compile.classpath"/>
            </classpath>
        </javac>
        <taskdef name="templateFromJava" classname="com.gs.fw.common.mithra.generator.TemplateFromJavaTask" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <templateFromJava input="${root}/reladomo/src/main/java/com/gs/fw/common/mithra/superclassimpl/MithraTransactionalObjectImpl.java"
            output="${root}/reladomogen/target/classes/com/gs/fw/common/mithra/generator/Transactional.tmpl"/>
        <templateFromJava input="${root}/reladomo/src/main/java/com/gs/fw/common/mithra/superclassimpl/MithraDatedTransactionalObjectImpl.java"
            output="${root}/reladomogen/target/classes/com/gs/fw/common/mithra/generator/DatedTransactional.tmpl"/>
        <delete quiet="true" file="${root}/reladomogen/target/classes/com/gs/fw/common/mithra/generator/mithragen.md5"/>
        <concat binary="true" destfile="${root}/reladomogen/target/mithragentemp.concat">
            <fileset dir="${root}/reladomogen/target/classes">
                <include name="com/gs/fw/common/mithra/generator/**/*.class"/>
                <include name="com/gs/fw/common/mithra/generator/**/*.tmpl*"/>
                <include name="com/gs/fw/common/mithra/templates/**/*.class"/>
            </fileset>
        </concat>
        <checksum file="${root}/reladomogen/target/mithragentemp.concat" property="mithragen.md5.property"/>
        <delete quiet="true" file="${root}/reladomogen/target/mithragentemp.concat"/>
        <echo message="${mithragen.md5.property}" file="${root}/reladomogen/target/classes/com/gs/fw/common/mithra/generator/mithragen.md5"/>
    </target>

    <target name="generate-reladomo-test-graph" depends="compile-reladomo-generator">
        <taskdef name="reladomo-graphgen" classname="com.gs.fw.common.mithra.generator.MithraGraphGenerator" loaderRef="mithraGenerator">
                <classpath refid="reladomogen.classpath"/>
        </taskdef>

        <reladomo-graphgen xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml"
                         outputFile="${root}/reladomo/target/reladomotest.graphml"
                         collapseRelationships="false"
                         showAttributes="primaryKey">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-graphgen>
    </target>

    <target name="reladomogen-javadoc">
        <javadoc packagenames="com.gs.fw.common.mithra.generator"
                 sourcepath="${root}/reladomogen/src/main/java"
                 defaultexcludes="yes"
                 access="public"
                 destdir="${root}/reladomogen/target/javadoc"
                 use="true"
                 windowtitle="Reladomo Generator User API"
                 version="yes"
                 Verbose="true">
            <classpath>
                <path refid="reladomogen.classpath"/>
            </classpath>
        </javadoc>
    </target>
    <!-- ************************** /reladomogen **********************************-->
    <!-- ************************** reladomo **********************************-->

    <target name="libboot-reladomo">
        <libboot specFile="build/reladomolib.spec"/>
    </target>

    <target name="xsd2bean-reladomo-runtime">
        <xsd2bean-gen parserName="MithraRuntime"
            destinationPackage="com.gs.fw.common.mithra.mithraruntime"
            xsd="${root}/reladomo/src/main/xsd/mithraruntime.xsd"
            generatedDir="${root}/reladomo/target/generated-src"
            nonGeneratedDir="${root}/reladomo/src/main/java"
            >
        </xsd2bean-gen>
    </target>

    <target name="xsd2bean-reladomo-cacheloader">
        <xsd2bean-gen parserName="MithraCacheLoader"
            destinationPackage="com.gs.fw.common.mithra.cacheloader.xmlbinding"
            xsd="${root}/reladomo/src/main/xsd/mithracacheloader.xsd"
            generatedDir="${root}/reladomo/target/generated-src"
            nonGeneratedDir="${root}/reladomo/src/main/java"
            >
        </xsd2bean-gen>
    </target>

    <target name="jarjar-asm">
        <libboot specFile="${root}/build/asmlib.spec"/>
        <path id="jarjar.classpath">
            <pathelement location="${root}/build/lib/jarjar-1.3.jar"/>
        </path>

        <taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask" loaderRef="jarjar">
            <classpath refid="jarjar.classpath"/>
        </taskdef>
        <mkdir dir="${root}/reladomo/target/tmp/asm"/>
        <jarjar jarfile="${root}/reladomo/target/reladomo-asm-4.2.jar">
            <fileset dir="${root}/reladomo/target/tmp/asm"/>
            <zipfileset src="${root}/build/asmlib/asm-4.2.jar"/>
            <rule pattern="org.objectweb.asm.**" result="com.gs.mithra.asm.@1"/>
        </jarjar>
        <delete quiet="true" dir="${root}/reladomo/target/tmp/asm"/>
    </target>

    <target name="generate-reladomo-replication-classes" depends="compile-reladomo-generator">
        <taskdef name="reladomo-gen" classname="com.gs.fw.common.mithra.generator.MithraGenerator" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <reladomo-gen xml="${root}/reladomo/src/main/reladomo-xml/replication/MithraReplicationNotificationClassList.xml"
            generatedDir="${root}/reladomo/target/generated-src"
            nonGeneratedDir="${root}/reladomo/src/main/java"
            generateConcreteClasses="${reladomo.generateConcreteClasses}"/>
    </target>

    <target name="generate-reladomo-txid-classes" depends="compile-reladomo-generator">
        <taskdef name="reladomo-gen" classname="com.gs.fw.common.mithra.generator.MithraGenerator" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <reladomo-gen xml="${root}/reladomo/src/main/reladomo-xml/txid/ReladomoTxidClassList.xml"
            generatedDir="${root}/reladomo/target/generated-src"
            nonGeneratedDir="${root}/reladomo/src/main/java"
            generateConcreteClasses="${reladomo.generateConcreteClasses}"/>
    </target>

    <target name="main-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomo/src/main/java"/>
            <srcfileset dir="${root}/reladomo/target/generated-src"/>
            <targetfileset dir="${root}/reladomo/target/classes" excludes="com/gs/mithra/**/*"/>
        </dependset>
    </target>

    <target name="compile-reladomo" depends="init-reladomo, jarjar-asm, libboot-reladomo, xsd2bean-reladomo-runtime, xsd2bean-reladomo-cacheloader, generate-reladomo-replication-classes, generate-reladomo-txid-classes, main-dependset">
        <unzip src="${root}/reladomo/target/reladomo-asm-4.2.jar" dest="${root}/reladomo/target/classes"/>
        <delete dir="${root}/reladomo/target/classes/META-INF" quiet="true"/>
        <delete dir="${root}/reladomo/target/classes/org" quiet="true"/>
        <javac destdir="${root}/reladomo/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            nowarn="true"
            includeAntRuntime="false">
            <src path="${root}/reladomo/src/main/java"/>
            <src path="${root}/reladomo/target/generated-src"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <target name="test-util-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomo/src/test-util/java"/>
            <srcfileset dir="${root}/reladomo/target/classes"/>
            <targetfileset dir="${root}/reladomo/target/test-util-classes"/>
        </dependset>
    </target>

    <target name="compile-reladomo-graphql" depends="init-reladomo, libboot-reladomo, compile-reladomo">
        <copy file="${root}/reladomographql/src/main/resources/meta.graphqls" todir="${root}/reladomographql/target/classes/" verbose="true"/>
        <javac destdir="${root}/reladomographql/target/classes"
               debug="true"
               source="1.8"
               target="1.8"
               nowarn="true"
               includeAntRuntime="false">
            <src path="${root}/reladomographql/src/main/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.compile.classpath"/>
                <path refid="reladomographql.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <target name="compile-reladomo-graphql-test" depends="compile-reladomo-graphql, compile-reladomo-test, compile-reladomo-test-util, test-util-dependset">
        <copy file="${root}/reladomographql/src/main/resources/meta.graphqls" todir="${root}/reladomographql/target/test-classes/" verbose="true"/>
        <javac destdir="${root}/reladomographql/target/test-classes"
               debug="true"
               source="1.8"
               target="1.8"
               nowarn="true"
               includeAntRuntime="false">
            <src path="${root}/reladomographql/src/test/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.test.compile.classpath"/>
                <path refid="reladomographql.test.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomo/target/test-classes-offheap"/>
                <pathelement location="${root}/reladomo/target/test-util-classes"/>
                <pathelement location="${root}/reladomographql/target/classes"/>
            </classpath>
        </javac>
    </target>

    <target name="run-reladomo-graphql-test-suite" depends="compile-reladomo-graphql-test, compile-reladomo-test" description="Run JUnit test cases for Reladomo GraphQL module">
        <delete quiet="true" dir="${root}/reladomographql/target/testresult"/>
        <mkdir dir="${root}/reladomographql/target/testresult"/>
        <tstamp>
            <format property="TIME_NOW" pattern="hh:mm:ss a z"/>
        </tstamp>
        <echo message="Log4j file: ${root}/reladomo/src/test/resources/log4jWarn.config"/>

        <sequential>
            <junit printsummary="on" dir="${root}/reladomographql" timeout="3600000" fork="yes" includeantruntime="true">
                <formatter type="xml" extension="junit"/>
                <formatter classname="com.gs.fw.common.mithra.test.JunitFormatter" extension="junit.txt"/>
                <classpath>
                    <path refid="reladomo.run.test.classpath"/>
                    <path refid="reladomo.test.compile.classpath"/>
                    <path refid="reladomographql.test.compile.classpath"/>
                    <pathelement location="${root}/reladomo/target/classes"/>
                    <pathelement location="${root}/reladomo/target/test-classes-offheap"/>
                    <pathelement location="${root}/reladomo/target/test-util-classes"/>
                    <pathelement location="${root}/reladomographql/target/classes"/>
                    <pathelement location="${root}/reladomographql/target/test-classes"/>
                </classpath>
                <jvmarg value="-server"/>
                <jvmarg value="${jacocovmarg}${root}/reladomographql/target/coverage/junit-tests.exec"/>
                <jvmarg value="-Xmx500m"/>
                <jvmarg value="-ea"/>
                <jvmarg value="-Dlog4j.configuration=file:${root}/reladomo/src/test/resources/log4jWarn.config"/>
                <jvmarg value="-Dmithra.xml.root=${root}/reladomographql/src/test/resources/"/>
                <jvmarg value="-Djacoco.args=${jacocovmarg}${root}/reladomographql/target/coverage/jacoco/junit-tests.exec"/>
                <jvmarg value="-Duser.timezone=America/New_York"/>
                <batchtest>
                    <fileset dir="${root}/reladomographql/target/test-classes" includes="**/*Test.java" />
                </batchtest>
            </junit>
        </sequential>
    </target>

    <target name="compile-reladomo-test-util" depends="compile-reladomo, test-util-dependset">
        <javac destdir="${root}/reladomo/target/test-util-classes"
            debug="true"
            source="1.8"
            target="1.8"
            nowarn="true"
            includeAntRuntime="false">
            <src path="${root}/reladomo/src/test-util/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.test.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <target name="reladomo-test-util-javadoc">
        <javadoc packagenames="com.gs.fw.common.mithra.test"
                 sourcepath="${root}/reladomo/src/test-util/java"
                 defaultexcludes="yes"
                 access="public"
                 destdir="${root}/reladomo/target/test-util-javadoc"
                 use="true"
                 windowtitle="Reladomo Test Utils User API"
                 version="yes"
                 Verbose="true">
            <classpath>
                <path refid="reladomo.test.compile.classpath"/>
            </classpath>
        </javadoc>
    </target>
    <!-- ************************** /reladomo **********************************-->
    <!-- ************************** reladomo test **********************************-->
    <target name="generate-reladomo-test-classes" depends="compile-reladomo-generator">
        <taskdef name="reladomo-gen" classname="com.gs.fw.common.mithra.generator.MithraGenerator" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/MithraClassListToImport.xml"
            generatedDir="${root}/reladomo/target/test-generated-onheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java"
            generateEcListMethod="${mithra.generateEcListMethod}"
            generateConcreteClasses="${reladomo.generateConcreteClasses}">
        </reladomo-gen>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml"
            generatedDir="${root}/reladomo/target/test-generated-onheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java"
            generateEcListMethod="${mithra.generateEcListMethod}"
            generateConcreteClasses="${reladomo.generateConcreteClasses}">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/testmithraimport/MithraTestImportClassList.xml"
            generatedDir="${root}/reladomo/target/test-generated-onheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassList.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassListToImport.xml"/>
        </reladomo-gen>

        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/MithraClassListToImport.xml"
            forceOffHeap="true"
            generatedDir="${root}/reladomo/target/test-generated-offheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java"
            generateEcListMethod="${mithra.generateEcListMethod}"
            generateConcreteClasses="${reladomo.generateConcreteClasses}">
        </reladomo-gen>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml"
            forceOffHeap="true"
            generatedDir="${root}/reladomo/target/test-generated-offheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java"
            generateEcListMethod="${mithra.generateEcListMethod}"
            generateConcreteClasses="${reladomo.generateConcreteClasses}">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/testmithraimport/MithraTestImportClassList.xml"
            forceOffHeap="true"
            generatedDir="${root}/reladomo/target/test-generated-offheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassList.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/" fileName="MithraClassListToImport.xml"/>
        </reladomo-gen>

    </target>

    <target name="generate-reladomo-test-classes-no-concrete" depends="compile-reladomo-generator">
        <taskdef name="reladomo-gen" classname="com.gs.fw.common.mithra.generator.MithraGenerator" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml"
            generatedDir="${mithra.home}/tmp/noconcrete"
            nonGeneratedDir="${mithra.home}/tmp/noconcrete" generateConcreteClasses="true"
            ignoreNonGeneratedAbstractClasses="true" ignoreTransactionalMethods="true">
        </reladomo-gen>

    </target>

    <target name="generate-reladomo-final-test-classes" depends="compile-reladomo-generator">
        <taskdef name="reladomo-gen" classname="com.gs.fw.common.mithra.generator.MithraGenerator" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/finalgetter/MithraFinalGetterClassList.xml"
            generatedDir="${root}/reladomo/target/test-generated-onheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java"
            generateEcListMethod="${mithra.generateEcListMethod}"
            generateConcreteClasses="${reladomo.generateConcreteClasses}"
                      defaultFinalGetters="true">
        </reladomo-gen>
        <reladomo-gen xml="${root}/reladomo/src/test/reladomo-xml/finalgetter/MithraFinalGetterClassList.xml"
            forceOffHeap="true"
            generatedDir="${root}/reladomo/target/test-generated-offheap-src"
            nonGeneratedDir="${root}/reladomo/src/test/java"
            generateEcListMethod="${mithra.generateEcListMethod}"
            generateConcreteClasses="${reladomo.generateConcreteClasses}"
                      defaultFinalGetters="true">
        </reladomo-gen>
    </target>

    <target name="test-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomo/src/test/java"/>
            <srcfileset dir="${root}/reladomo/target/test-generated-onheap-src"/>
            <srcfileset dir="${root}/reladomo/target/test-generated-offheap-src"/>
            <srcfileset dir="${root}/reladomo/target/classes"/>
            <srcfileset dir="${root}/reladomo/target/test-util-classes"/>
            <targetfileset dir="${root}/reladomo/target/test-classes-onheap"/>
            <targetfileset dir="${root}/reladomo/target/test-classes-offheap"/>
        </dependset>
    </target>

    <target name="compile-reladomo-test" depends="compile-reladomo-test-util, compile-reladomo-genutil, generate-reladomo-test-classes, generate-reladomo-final-test-classes, test-dependset">
        <javac destdir="${root}/reladomo/target/test-classes-onheap"
            debug="true"
            source="1.8"
            target="1.8"
            nowarn="true"
            includeAntRuntime="true">
            <src path="${root}/reladomo/src/test/java"/>
            <src path="${root}/reladomo/target/test-generated-onheap-src"/>
            <exclude name="com/gs/fw/common/mithra/test/offheap/**/*.java"/>
            <classpath>
                <path refid="reladomo.test.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomo/target/test-util-classes"/>
            </classpath>
        </javac>
        <javac destdir="${root}/reladomo/target/test-classes-offheap"
            debug="true"
            source="1.8"
            target="1.8"
            nowarn="true"
            includeAntRuntime="true">
            <src path="${root}/reladomo/src/test/java"/>
            <src path="${root}/reladomo/target/test-generated-offheap-src"/>
            <classpath>
                <path refid="reladomo.test.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomo/target/test-util-classes"/>
            </classpath>
        </javac>
    </target>
    <target name="run-reladomo-test-suite" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <property name="jacocovmarg" value="-Dcoverage=none"/>
        <delete quiet="true" dir="${root}/reladomo/target/testresult"/>
        <mkdir dir="${root}/reladomo/target/testresult"/>
        <tstamp>
            <format property="TIME_NOW" pattern="hh:mm:ss a z"/>
        </tstamp>
        <echo message="JUnit master suite for Reladomo starting at ${TIME_NOW} on ${TODAY} with ${test.threads} jvms."/>
        <echo message="Log4j file: ${root}/reladomo/src/test/resources/log4jWarn.config"/>
        <parallel threadcount="${test.threads}" >
            <exec-test-suite mithraxmlconfig="MithraConfigFullCache.xml" qualifier="/full" testclass="com.gs.fw.common.mithra.test.MithraTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigFullCache.xml" qualifier="/full" testclass="com.gs.fw.common.mithra.test.MithraMultiVmTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.fw.common.mithra.test.MithraMultiVmTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.fw.common.mithra.test.MithraTestSuite" heap="onheap"/>

            <exec-test-suite mithraxmlconfig="MithraConfigOffHeapFullCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.offheap.MithraOffHeapTestSuite" heap="offheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigOffHeapFullCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.MithraTestSuite" heap="offheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigOffHeapFullCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.MithraMultiVmTestSuite" heap="offheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigMasterCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.MithraMultiVmOffHeapTestSuite" heap="offheap"/>
            <exec-test-suite mithraxmlconfig="Util.xml" testclass="com.gs.fw.common.mithra.test.MithraUtilTestSuite" heap="onheap"/>

            <exec-test-suite mithraxmlconfig="MithraCacheTestConfig.xml" qualifier="/full" testclass="com.gs.fw.common.mithra.test.cacheloader.CacheLoaderSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.fw.common.mithra.test.MithraToStringTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" testclass="com.gs.fw.common.mithra.test.generator.GeneratorTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraTestTableManagerConfig.xml" testclass="com.gs.fw.common.mithra.test.TestTablePartitionManager" heap="onheap"/>
        </parallel>
    </target>

    <macrodef name="ci-test-suite">
        <attribute name="mithraxmlconfig" description="mithra.xml.config"/>
        <attribute name="testclass" description="test class"/>
        <attribute name="qualifier" description="added to the end of the test name" default=""/>
        <attribute name="heap" description="either 'onheap' or 'offheap"/>
        <sequential>
            <property name="jacocovmarg" value="-Dcoverage=none"/>
            <delete quiet="true" dir="${root}/reladomo/target/testresult"/>
            <mkdir dir="${root}/reladomo/target/testresult"/>

            <exec-test-suite mithraxmlconfig="@{mithraxmlconfig}" qualifier="@{qualifier}" testclass="@{testclass}" heap="@{heap}"/>
            <fail if="failed.mithra.unit.tests" message="Reladomo unit tests failed"/>
        </sequential>
    </macrodef>


    <target name="reladomo-test-suite1" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.fw.common.mithra.test.MithraTestSuite" heap="onheap"/>
    </target>

    <target name="reladomo-test-suite2" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="MithraConfigFullCache.xml" qualifier="/full" testclass="com.gs.fw.common.mithra.test.MithraTestSuite" heap="onheap"/>
    </target>

    <target name="reladomo-test-suite3" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.fw.common.mithra.test.MithraMultiVmTestSuite" heap="onheap"/>
    </target>

    <target name="reladomo-test-suite4" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="MithraConfigFullCache.xml" qualifier="/full" testclass="com.gs.fw.common.mithra.test.MithraMultiVmTestSuite" heap="onheap"/>
    </target>

    <target name="reladomo-test-suite5" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="MithraConfigOffHeapFullCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.MithraMultiVmTestSuite" heap="offheap"/>
    </target>

    <target name="reladomo-test-suite6" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="MithraConfigOffHeapFullCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.MithraTestSuite" heap="offheap"/>
    </target>

    <target name="reladomo-test-suite7" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <ci-test-suite mithraxmlconfig="Util.xml" testclass="com.gs.fw.common.mithra.test.MithraUtilTestSuite" heap="onheap"/>
    </target>

    <target name="reladomo-test-suite9" depends="compile-reladomo-test, compile-reladomo-genutil-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <property name="jacocovmarg" value="-Dcoverage=none"/>
        <delete quiet="true" dir="${root}/reladomo/target/testresult"/>
        <mkdir dir="${root}/reladomo/target/testresult"/>

        <exec-test-suite mithraxmlconfig="MithraConfigOffHeapFullCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.offheap.MithraOffHeapTestSuite" heap="offheap"/>
        <exec-test-suite mithraxmlconfig="MithraConfigMasterCache.xml" qualifier="/fulloffheap" testclass="com.gs.fw.common.mithra.test.MithraMultiVmOffHeapTestSuite" heap="offheap"/>
        <exec-test-suite mithraxmlconfig="MithraCacheTestConfig.xml" qualifier="/full" testclass="com.gs.fw.common.mithra.test.cacheloader.CacheLoaderSuite" heap="onheap"/>
        <exec-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.fw.common.mithra.test.MithraToStringTestSuite" heap="onheap"/>
        <exec-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" testclass="com.gs.fw.common.mithra.test.generator.GeneratorTestSuite" heap="onheap"/>
        <exec-test-suite mithraxmlconfig="MithraTestTableManagerConfig.xml" testclass="com.gs.fw.common.mithra.test.TestTablePartitionManager" heap="onheap"/>
        <fail if="failed.mithra.unit.tests" message="Reladomo unit tests failed"/>
    </target>

    <target name="reladomo-junitreport" if="junitHtmlReport" depends="run-reladomo-test-suite">
        <mkdir dir="${root}/reladomo/target/junit-report"/>
        <junitreport>
            <fileset dir="${root}/reladomo/target/testresult">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="noframes" todir="${root}/reladomo/target/junit-report"/>
        </junitreport>
    </target>

    <target name="reladomo-test-suite" depends="generate-reladomo-test-graph, reladomo-junitreport" description="Run JUnit test cases for Reladomo code">
        <fail if="failed.mithra.unit.tests" message="Reladomo unit tests failed"/>
    </target>

    <target name="reladomo-test-coverage" depends="-jacoco-init,compile-reladomo, reladomo-test-suite, reladomo-coverage-report"/>

    <target name="reladomo-coverage-report" depends="-jacoco-init">
        <mkdir dir="${root}/reladomo/target/coverage/report"/>
        <jacoco:merge destfile="${root}/reladomo/target/coverage/mergedData.exec">
            <fileset dir="${root}/reladomo/target/coverage" includes="*.exec, *.execworker"/>
        </jacoco:merge>
        <jacoco:report>
            <!-- This task needs the collected execution data  -->
            <executiondata>
                <file file="${root}/reladomo/target/coverage/mergedData.exec"/>
            </executiondata>

            <!-- the class files and optional source files  -->
            <structure name="Reladomo">
                <classfiles>
                    <fileset refid="class"/>
                </classfiles>
                <sourcefiles encoding="UTF-8">
                    <fileset refid="coverage-src"/>
                </sourcefiles>
            </structure>

            <!-- to produce reports in html format -->
            <html destdir="${root}/reladomo/target/coverage/report"/>
        </jacoco:report>
    </target>
    <!-- ************************** /reladomo test **********************************-->
    <!-- ************************** reladomo docs **************************** -->
    <target name="reladomo-xsddoc" depends="init-reladomo">
        <java classname="org.apache.xalan.xslt.Process" >
            <classpath refid="xslt.processor.classpath"/>
            <arg line="-IN ${root}/reladomogen/src/main/xsd/mithraobject.xsd"/>
            <arg line="-XSL ${root}/build/xs3p-1.1.5.xsl"/>
            <arg line="-OUT ${root}/reladomo/target/xsddoc/index.html"/>
        </java>
    </target>

    <target name="reladomo-javadoc">
       <javadoc packagenames="com.gs.fw.common.mithra,com.gs.fw.common.mithra.connectionmanager.*, com.gs.fw.common.mithra.databasetype.*,com.gs.fw.finder.*"
           sourcepath="${root}/reladomo/src/main/java;${root}/reladomo/target/generatedsrc"
           defaultexcludes="yes"
           access="public"
           destdir="${root}/reladomo/target/javadoc"
           use="true"
           windowtitle="Reladomo User API"
           version="yes"
           Verbose="true">
           <classpath>
                 <path refid="reladomogen.classpath"/>
                 <path refid="reladomo.compile.classpath"/>
                 <pathelement location="${root}/reladomo/target/classes"/>
           </classpath>
      </javadoc>
    </target>

    <!-- DocBook file generation for Reladomo docs -->
    <property name="docbook.customization.dir" value="${root}/reladomo/src/doc/docbook/customization"/>
    <property name="docbook.html.stylesheet" value="${docbook.customization.dir}/html.xsl"/>
    <property name="docbook.fo.stylesheet" value="${docbook.customization.dir}/fo.xsl"/>

    <property name="docbook.xslt.highlightsheet" value="${root}/reladomo/target/docbook-lib/docbook/highlighting/xslthl-config.xml"/>

    <property name="reladomo.doc.docbook.dir" value="${root}/reladomo/src/doc/docbook"/>
    <property name="reladomo.doc.docbook.out.dir" value="${root}/reladomo/target/docbook"/>
    <property name="xslt.processor.class" value="org.apache.xalan.xslt.Process" />

    <property name="fop.dir" value="${mithra.home}/build/lib/fop"/>

    <target name="reladomo-unzip-docbook" depends="init-reladomo">
        <unzip src="${root}/build/lib/docbook-xsl-${docbook-xsl.version}-ns-resources.zip" dest="${root}/reladomo/target/docbook-lib"/>
    </target>

    <macrodef name="docbook-to-html">
        <attribute name="docbook-dir" default=""/>
        <attribute name="source" default=""/>
        <attribute name="output-dir" default=""/>
        <sequential>
            <mkdir dir="@{output-dir}"/>
            <java classname="${xslt.processor.class}"
                  fork="yes"
                  dir="@{docbook-dir}"
                  failonerror="true">
                <classpath refid="xslt.processor.classpath" />
                <jvmarg value="-Djava.awt.headless=true"/>
                <jvmarg value="-Dxslthl.config=file:///${docbook.xslt.highlightsheet}"/>
                <arg line="-out @{output-dir}/@{source}.html"/>
                <arg line="-l"/>
                <arg line="-in @{docbook-dir}/@{source}.xml -xsl ${docbook.html.stylesheet} -param use.extensions 1" />
            </java>
            <copy todir="@{output-dir}">
                <fileset dir="${docbook.customization.dir}">
                    <include name="*.js"/>
                    <include name="*.css"/>
                </fileset>
                <fileset dir="@{docbook-dir}">
                    <include name="*.gif"/>
                    <include name="*.png"/>
                    <include name="*.svg"/>
                    <include name="*.eps"/>
                </fileset>
            </copy>
        </sequential>
    </macrodef>

    <taskdef name="fop" classname="org.apache.fop.tools.anttasks.Fop">
        <classpath refid="fop.classpath"/>
    </taskdef>

    <macrodef name="docbook-to-pdf">
        <attribute name="docbook-dir" default=""/>
        <attribute name="source" default=""/>
        <attribute name="output-dir" default=""/>
        <sequential>
            <mkdir dir="@{output-dir}"/>
            <delete quiet="true" file="@{output-dir}/temp.fo"/>
            <java classname="${xslt.processor.class}"
                  fork="yes"
                  dir="@{docbook-dir}"
                  failonerror="true">
                <classpath refid="xslt.processor.classpath" />
                <jvmarg value="-Djava.awt.headless=true"/>
                <jvmarg value="-Dxslthl.config=file:///${docbook.xslt.highlightsheet}"/>
                <arg line="-out @{output-dir}/temp.fo"/>
                <arg line="-l"/>
                <arg line="-in @{docbook-dir}/@{source}.xml -xsl ${docbook.fo.stylesheet} -param use.extensions 1"/>
            </java>

            <fop format="application/pdf"
                 fofile="@{output-dir}/temp.fo"
                 outfile="@{output-dir}/@{source}.pdf"
                 basedir="@{docbook-dir}"
                 messagelevel="error"/>

            <delete file="@{output-dir}/temp.fo"/>
        </sequential>
    </macrodef>

    <target name="reladomo-doc-generate-html" depends="reladomo-unzip-docbook">
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/mithraddl"           output-dir="${reladomo.doc.docbook.out.dir}/mithraddl"           source="ReladomoDdlGenerator"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/architecture"        output-dir="${reladomo.doc.docbook.out.dir}/architecture"        source="ReladomoInternalArchitecture"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/objectxmlgenerator"  output-dir="${reladomo.doc.docbook.out.dir}/objectxmlgenerator"  source="Generator"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/userguide"           output-dir="${reladomo.doc.docbook.out.dir}/userguide"           source="ReladomoTutorial"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/mithraTestResource"  output-dir="${reladomo.doc.docbook.out.dir}/mithraTestResource"  source="ReladomoTestResource"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/philosophy"          output-dir="${reladomo.doc.docbook.out.dir}/philosophy"          source="ReladomoPhilosophy"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/visualization"       output-dir="${reladomo.doc.docbook.out.dir}/visualization"       source="ReladomoVisualization"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/testing"             output-dir="${reladomo.doc.docbook.out.dir}/testing"             source="TestingPhilosophy"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/mithrafaq"           output-dir="${reladomo.doc.docbook.out.dir}/mithrafaq"           source="ReladomoFaq"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/primaryKeyGenerator" output-dir="${reladomo.doc.docbook.out.dir}/primaryKeyGenerator" source="PrimaryKeyGenerator"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/serialization" output-dir="${reladomo.doc.docbook.out.dir}/serialization" source="Serialization"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/middletier"          output-dir="${reladomo.doc.docbook.out.dir}/middleTier"          source="ReladomoMiddleTier"/>
        <docbook-to-html docbook-dir="${reladomo.doc.docbook.dir}/notification"        output-dir="${reladomo.doc.docbook.out.dir}/notification"        source="Notification"/>
    </target>

    <target name="reladomo-doc-generate-pdf" depends="reladomo-unzip-docbook">
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/mithraddl"            output-dir="${reladomo.doc.docbook.out.dir}/mithraddl"           source="ReladomoDdlGenerator"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/architecture"         output-dir="${reladomo.doc.docbook.out.dir}/architecture"        source="ReladomoInternalArchitecture"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/objectxmlgenerator"   output-dir="${reladomo.doc.docbook.out.dir}/objectxmlgenerator"  source="Generator"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/userguide"            output-dir="${reladomo.doc.docbook.out.dir}/userguide"           source="ReladomoTutorial"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/mithraTestResource"   output-dir="${reladomo.doc.docbook.out.dir}/mithraTestResource"  source="ReladomoTestResource"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/philosophy"           output-dir="${reladomo.doc.docbook.out.dir}/philosophy"          source="ReladomoPhilosophy"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/visualization"        output-dir="${reladomo.doc.docbook.out.dir}/visualization"       source="ReladomoVisualization"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/testing"              output-dir="${reladomo.doc.docbook.out.dir}/testing"             source="TestingPhilosophy"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/mithrafaq"            output-dir="${reladomo.doc.docbook.out.dir}/mithrafaq"           source="ReladomoFaq"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/primaryKeyGenerator"  output-dir="${reladomo.doc.docbook.out.dir}/primaryKeyGenerator" source="PrimaryKeyGenerator"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/serialization"           output-dir="${reladomo.doc.docbook.out.dir}/serialization"          source="Serialization"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/middletier"           output-dir="${reladomo.doc.docbook.out.dir}/middleTier"          source="ReladomoMiddleTier"/>
        <docbook-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/notification"         output-dir="${reladomo.doc.docbook.out.dir}/notification"        source="Notification"/>
    </target>

    <target name="reladomo-docbook" depends="reladomo-doc-generate-html, reladomo-doc-generate-pdf"/>

    <target name="generate-reladomo-docs" depends="reladomo-xsddoc, reladomo-javadoc, reladomo-docbook, reladomo-slides"/>

    <property name="docbook.slides.customization.dir" value="${root}/reladomo/src/doc/docbook/presentations/customization"/>
    <property name="docbook.slides.stylesheet" value="${docbook.slides.customization.dir}/html.xsl"/>
    <property name="docbook.slides.fo.stylesheet" value="${docbook.slides.customization.dir}/fo.xsl"/>

    <target name="reladomo-slide-generate-html" depends="reladomo-unzip-docbook">
        <slides-to-html docbook-dir="${reladomo.doc.docbook.dir}/presentations/mithraAdvancedUseCases" output-dir="${reladomo.doc.docbook.out.dir}/presentations/mithraAdvancedUseCases" source="ReladomoAdvancedUseCases" presentation-title="Reladomo Advanced Use Cases"/>
        <slides-to-html docbook-dir="${reladomo.doc.docbook.dir}/presentations/mithraFeatures" output-dir="${reladomo.doc.docbook.out.dir}/presentations/mithraFeatures" source="ReladomoFeatures" presentation-title="Reladomo Features"/>
        <slides-to-html docbook-dir="${reladomo.doc.docbook.dir}/presentations/javaBigMemory" output-dir="${reladomo.doc.docbook.out.dir}/presentations/javaBigMemory" source="JavaBigMemory" presentation-title="Java Big Memory"/>
        <slides-to-html docbook-dir="${reladomo.doc.docbook.dir}/presentations/reladomoInternalCacheStructure" output-dir="${reladomo.doc.docbook.out.dir}/presentations/reladomoInternalCacheStructure" source="ReladomoInternalCacheStructure" presentation-title="Reladomo InternalCache Structure"/>
    </target>

    <target name="reladomo-slide-generate-pdf" depends="reladomo-unzip-docbook">
        <slides-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/presentations/mithraAdvancedUseCases" output-dir="${reladomo.doc.docbook.out.dir}/presentations/mithraAdvancedUseCases" source="ReladomoAdvancedUseCases" />
        <slides-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/presentations/mithraFeatures" output-dir="${reladomo.doc.docbook.out.dir}/presentations/mithraFeatures" source="ReladomoFeatures" />
        <slides-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/presentations/javaBigMemory" output-dir="${reladomo.doc.docbook.out.dir}/presentations/javaBigMemory" source="JavaBigMemory" />
        <slides-to-pdf docbook-dir="${reladomo.doc.docbook.dir}/presentations/reladomoInternalCacheStructure" output-dir="${reladomo.doc.docbook.out.dir}/presentations/reladomoInternalCacheStructure" source="ReladomoInternalCacheStructure" />
    </target>

    <macrodef name="slides-to-html">
        <attribute name="docbook-dir" default=""/>
        <attribute name="source" default=""/>
        <attribute name="output-dir" default=""/>
        <attribute name="presentation-title" default=""/>
        <sequential>
            <mkdir dir="@{output-dir}"/>
            <delete dir="@{output-dir}/files"/>
            <copy todir="@{output-dir}/files/slidy">
                <fileset dir="${root}/reladomo/target/docbook-lib/docbook/slides/slidy"/>
            </copy>
            <replace dir="${root}/reladomo/target/docbook-lib/docbook/slides/xhtml" value="">
                <include name="plain-titlepage.xsl"/>
                <replacetoken> xsl:use-attribute-sets=&quot;slides.titlepage.recto.style&quot;</replacetoken>
            </replace>

            <java classname="${xslt.processor.class}"
                fork="yes"
                dir="@{docbook-dir}"
                failonerror="true">
                <classpath refid="xslt.processor.classpath" />
                <jvmarg value="-Djava.awt.headless=true"/>
                <jvmarg value="-Dxslthl.config=file:///${docbook.xslt.highlightsheet}"/>
                <arg line="-out @{output-dir}/@{source}.xhtml"/>
                <arg line="-l"/>
                <arg line="-in @{docbook-dir}/@{source}.xml -xsl ${docbook.slides.stylesheet} -param use.extensions 1" />
            </java>
            <copy todir="@{output-dir}">
                <fileset dir="@{docbook-dir}">
                    <include name="*.gif"/>
                    <include name="*.png"/>
                    <include name="*.svg"/>
                    <include name="*.eps"/>
                    <include name="*.html"/>
                </fileset>
            </copy>
            <copy todir="@{output-dir}">
                <fileset dir="${docbook.slides.customization.dir}">
                    <include name="*.css"/>
                </fileset>
            </copy>
            <replace dir="@{output-dir}" value="">
                <include name="@{source}.xhtml"/>
                <replacetoken>&lt;link type=&quot;text/css&quot; href=&quot;files/slidy/styles/slidy.css&quot; rel=&quot;stylesheet&quot;/&gt;</replacetoken>
            </replace>
            <replace dir="@{output-dir}" value="">
                <include name="@{source}.xhtml"/>
                <replacetoken>&lt;link type=&quot;text/css&quot; href=&quot;files/slidy/styles/w3c-blue.css&quot; rel=&quot;stylesheet&quot;/&gt;</replacetoken>
            </replace>
            <replace dir="@{output-dir}" value="&lt;div class=&quot;slide cover title&quot;&gt;&lt;h1 class=&quot;title&quot;&gt;@{presentation-title}&lt;/h1&gt;&lt;/div&gt;">
                <include name="@{source}.xhtml"/>
                <replacetoken>&lt;div xmlns:dbs=&quot;http://docbook.org/ns/docbook-slides&quot; class=&quot;slide cover title&quot;/&gt;</replacetoken>
            </replace>
            <replace dir="@{output-dir}" value="">
                <include name="@{source}.xhtml"/>
                <replacetoken>xmlns=&quot;&quot;</replacetoken>
            </replace>

            <delete>
                <fileset dir="@{docbook-dir}">
                    <include name="*.html"/>
                </fileset>
            </delete>
        </sequential>
    </macrodef>

    <macrodef name="slides-to-pdf">
        <attribute name="docbook-dir" default=""/>
        <attribute name="source" default=""/>
        <attribute name="output-dir" default=""/>
        <sequential>
            <mkdir dir="@{output-dir}"/>
            <delete quiet="true" file="@{output-dir}/temp.fo"/>
            <java classname="${xslt.processor.class}"
                fork="yes"
                dir="@{docbook-dir}"
                failonerror="true">
                <classpath refid="xslt.processor.classpath" />
                <jvmarg value="-Djava.awt.headless=true"/>
                <jvmarg value="-Dxslthl.config=file:///${docbook.xslt.highlightsheet}"/>
                <arg line="-out @{output-dir}/temp.fo"/>
                <arg line="-l"/>
                <arg line="-in @{docbook-dir}/@{source}.xml -xsl ${docbook.slides.fo.stylesheet} -param use.extensions 1"/>
            </java>

            <replace dir="@{output-dir}" value="&lt;fo:table-cell text-align=&quot;center&quot;&gt;
                &lt;fo:block/&gt;
                &lt;/fo:table-cell&gt;">
                <include name="*.fo"/>
                <replacetoken>&lt;fo:table-cell text-align=&quot;center&quot;/&gt;</replacetoken>
            </replace>

            <fop format="application/pdf"
                fofile="@{output-dir}/temp.fo"
                outfile="@{output-dir}/@{source}.pdf"
                basedir="@{docbook-dir}"
                messagelevel="error"/>

            <delete file="@{output-dir}/temp.fo"/>
        </sequential>
    </macrodef>

    <target name="reladomo-slides" depends="reladomo-slide-generate-html, reladomo-slide-generate-pdf"/>

    <!-- ************************** /reladomo docs **************************** -->

    <!-- ************************** reladomogenutil **********************************-->

    <target name="compile-reladomo-genutil" depends="compile-reladomo">
        <dependset>
            <srcfileset dir="${root}/reladomogenutil/src/main/java"/>
            <srcfileset dir="${root}/reladomogen/target/classes">
                <exclude name="com/gs/fw/common/mithra/generator/mithragen.md5"/>
            </srcfileset>
            <srcfileset dir="${root}/reladomo/target/classes"/>
            <targetfileset dir="${root}/reladomogenutil/target/classes"/>
        </dependset>
        <javac destdir="${root}/reladomogenutil/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            includeAntRuntime="true">
            <src path="${root}/reladomogenutil/src/main/java"/>
            <classpath>
                <path refid="reladomo.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomogen/target/classes"/>
            </classpath>
        </javac>
    </target>

    <target name="reladomo-gen-util-javadoc">
        <javadoc packagenames="com.gs.fw.common.mithra,com.gs.fw.common.mithra.generator.dbgenerator.*, com.gs.fw.common.mithra.generator.objectxmlgenerator.*"
                 sourcepath="${root}/reladomogenutil/src/main/java"
                 defaultexcludes="yes"
                 access="public"
                 destdir="${root}/reladomogenutil/target/javadoc"
                 use="true"
                 windowtitle="Reladomo Generator Utilities"
                 version="yes"
                 Verbose="true">
            <classpath>
                <path refid="reladomogen.classpath"/>
                <path refid="reladomo.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomogenutil/target/classes"/>
                <fileset refid="fileset.build.lib"/>
            </classpath>
        </javadoc>
    </target>

    <target name="compile-reladomo-genutil-test" depends="compile-reladomo-test">
        <dependset>
            <srcfileset dir="${root}/reladomogenutil/src/test/java"/>
            <srcfileset dir="${root}/reladomogen/target/classes">
                <exclude name="com/gs/fw/common/mithra/generator/mithragen.md5"/>
            </srcfileset>
            <srcfileset dir="${root}/reladomo/target/classes"/>
            <srcfileset dir="${root}/reladomo/target/test-classes-onheap"/>
            <srcfileset dir="${root}/reladomo/target/test-util-classes"/>
            <srcfileset dir="${root}/reladomogenutil/target/classes"/>
            <targetfileset dir="${root}/reladomogenutil/target/test-classes"/>
        </dependset>
        <javac destdir="${root}/reladomogenutil/target/test-classes"
            debug="true"
            source="1.8"
            target="1.8"
            includeAntRuntime="true">
            <src path="${root}/reladomogenutil/src/test/java"/>
            <classpath>
                <path refid="reladomo.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomo/target/test-classes-onheap"/>
                <pathelement location="${root}/reladomo/target/test-util-classes"/>
                <pathelement location="${root}/reladomogen/target/classes"/>
                <pathelement location="${root}/reladomogenutil/target/classes"/>
            </classpath>
        </javac>
    </target>

    <target name="generate-reladomo-db-test" depends="compile-reladomo-genutil">
        <taskdef name="reladomo-gen-db" classname="com.gs.fw.common.mithra.generator.dbgenerator.MithraDbDefinitionGenerator" loaderRef="mithraGeneratorDb">
           <classpath refid="reladomo.run.test.classpath"/>
        </taskdef>
        <reladomo-gen-db xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml" generatedDir="${root}/reladomogenutil/target/db/mssql" databaseType="mssql">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen-db>
        <reladomo-gen-db xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml" generatedDir="${root}/reladomogenutil/target/db/sybase" databaseType="sybase">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen-db>
        <reladomo-gen-db xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml" generatedDir="${root}/reladomogenutil/target/db/db2" databaseType="udb82">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen-db>
        <reladomo-gen-db xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml" generatedDir="${root}/reladomogenutil/target/db/postgres" databaseType="postgres">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen-db>
        <reladomo-gen-db xml="${root}/reladomo/src/test/reladomo-xml/MithraClassList.xml" generatedDir="${root}/reladomogenutil/target/db/oracle" databaseType="oracle">
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml" fileName="MithraClassListToImport.xml"/>
            <mithraImport dir="${root}/reladomo/src/test/reladomo-xml/testmithraimport" fileName="MithraTestImportClassList.xml"/>
        </reladomo-gen-db>
    </target>

    <target name="generate-reladomo-xml-test" depends="compile-reladomo-genutil">
        <property file="${root}/reladomo/src/test/resources/credentials.properties"/>
        <taskdef name="reladomo-gen-xml" classname="com.gs.fw.common.mithra.generator.objectxmlgenerator.MithraObjectXmlGenerator" loaderRef="mithraXmlGenerator">
            <classpath refid="reladomo.genutil.run.classpath"/>
        </taskdef>
        <mkdir dir ="${root}/reladomogenutil/target/reverse/sybase"/>
        <reladomo-gen-xml userName="${sybase_username}" password="${sybase_password}" databaseType="sybase" outputDir="${root}/reladomogenutil/target/reverse/sybase"
                    driver="com.sybase.jdbc4.jdbc.SybDriver"
                    url="${sybase_url}" schema="${sybase_schema}" includeTables="ALL_TYPES, IDENTITY_TABLE, PRODUCT, TEST_BALANCE_NO_ACMAP, ORDERS, ORDER_ITEM"/>
        <mkdir dir ="${root}/reladomogenutil/target/reverse/postgres"/>
        <reladomo-gen-xml userName="${postgres_user}" password="${postgres_password}" databaseType="postgres" outputDir="${root}/reladomogenutil/target/reverse/postgres"
                    driver="org.postgresql.Driver"
                    url="jdbc:postgresql://${postgres_hostName}:${postgres_port}/${postgres_databaseName}" schema="${postgres_schemaName}"
                          includeTables="all_types, identity_table, product, test_balance_no_acmap, orders, order_item, big_orders"/>
        <mkdir dir ="${root}/reladomogenutil/target/reverse/oracle"/>
        <reladomo-gen-xml userName="${oracle_user}" password="${oracle_password}" databaseType="oracle" outputDir="${root}/reladomogenutil/target/reverse/oracle"
                    driver="oracle.jdbc.driver.OracleDriver"
                    url="jdbc:oracle:thin:@${oracle_hostName}:${oracle_port}:${oracle_ssid}" schema="${oracle_schemaName}"
                          includeTables="ALL_TYPES, IDENTITY_TABLE, PRODUCT, TEST_BALANCE_NO_ACMAP, ORDERS, ORDER_ITEM, BIG_ORDERS"/>
        <mkdir dir ="${root}/reladomogenutil/target/reverse/mssql"/>
        <reladomo-gen-xml userName="${mssql_user}" password="${mssql_password}" databaseType="mssql" outputDir="${root}/reladomogenutil/target/reverse/mssql"
                    driver="com.microsoft.sqlserver.jdbc.SQLServerDriver"
                    url="jdbc:sqlserver://${mssql_hostName}:${mssql_port}" schema="${mssql_schemaName}"
                          includeTables="ALL_TYPES, IDENTITY_TABLE, PRODUCT, TEST_BALANCE_NO_ACMAP, ORDERS, ORDER_ITEM, BIG_ORDERS"/>
        <mkdir dir ="${root}/reladomogenutil/target/reverse/maria"/>
        <reladomo-gen-xml userName="${maria_user}" password="${maria_password}" databaseType="maria" outputDir="${root}/reladomogenutil/target/reverse/maria"
                    driver="org.mariadb.jdbc.Driver"
                    url="jdbc:mariadb://${maria_hostname}:${maria_port}/${maria_databaseName}" schema="${maria_schemaName}"
                          includeTables="ALL_TYPES, IDENTITY_TABLE, PRODUCT, TEST_BALANCE_NO_ACMAP, ORDERS, ORDER_ITEM, BIG_ORDERS"/>
    </target>

    <!-- ************************** /reladomogenutil **********************************-->

    <!-- ************************** release opensource ***********************************-->
    <macrodef name="generate-pom">
        <attribute name="module" description="The name of module"/>
        <sequential>
            <copy file="${root}/build/pom-templates/pom-@{module}.xml"
                  toFile="${root}/target/@{module}-${reladomo.version}.pom">
            </copy>
            <replace casesensitive="true" dir="${root}/target" includes="@{module}-${reladomo.version}.pom">
                <replacefilter token="@reladomo.version@" value="${reladomo.version}"/>
            </replace>
        </sequential>
    </macrodef>

    <target name="jar-reladomogen" depends="compile-reladomo-generator">
        <jar jarfile="${root}/target/reladomogen-${reladomo.version}.jar" index="true">
            <fileset dir="${root}/reladomogen/src/main/xsd">
                <include name="mithraobject.xsd"/>
            </fileset>
            <fileset dir="${root}/reladomogen/target/classes"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomogen-src" depends="compile-reladomo-generator">
        <jar jarfile="${root}/target/reladomogen-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomogen/src/main/xsd"/>
            <fileset dir="${root}/reladomogen/src/main/templates"/>
            <fileset dir="${root}/reladomogen/src/main/java"/>
            <fileset dir="${root}/reladomogen/target/generated-src"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomogen-javadoc" depends="reladomogen-javadoc">
        <jar jarfile="${root}/target/reladomogen-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomogen/target/javadoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="gen-reladomogen-pom" depends="init-reladomo">
        <generate-pom module="reladomogen"/>
    </target>

    <target name="prep-reladomogen" depends="gen-reladomogen-pom, jar-reladomogen, jar-reladomogen-src, jar-reladomogen-javadoc"/>

    <target name="jar-reladomo" depends="compile-reladomo">
        <taskdef name="jar-with-version" classname="com.gs.fw.JarVersionCreator" loaderRef="jarVersionChecker">
            <classpath>
                <pathelement location="${root}/reladomogen/target/classes"/>
            </classpath>
        </taskdef>

        <jar-with-version jarfile="${root}/target/reladomo-${reladomo.version}.jar" index="true" applicationName="reladomo" version="${reladomo.version}">
            <manifest>
                <attribute name="Reladomo-Version" value="${reladomo.version}"/>
            </manifest>
            <fileset dir="${root}/reladomo/target/classes">
                <include name="**/*"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar-with-version>
    </target>

    <target name="jar-reladomo-src" depends="init-reladomo, compile-reladomo">
        <jar jarfile="${root}/target/reladomo-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomo/src/main/java">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="${root}/reladomo/target/generated-src">
                <include name="**/*.java"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-javadoc" depends="reladomo-javadoc, reladomo-docbook, reladomo-slides, reladomo-xsddoc">
        <jar jarfile="${root}/target/reladomo-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomo/target/javadoc"/>
            <fileset dir="${root}/reladomo/target/docbook"/>
            <fileset dir="${root}/reladomo/target/xsddoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="reladomo-graphql-javadoc">
        <javadoc packagenames="com.gs.reladomo.graphql"
                 sourcepath="${root}/reladomographql/src/main/java"
                 defaultexcludes="yes"
                 access="public"
                 destdir="${root}/reladomo/target/reladomographql-javadoc"
                 use="true"
                 windowtitle="Reladomo GraphQL Integration Module"
                 version="yes"
                 Verbose="true">
            <classpath>
                <path refid="reladomo.test.compile.classpath"/>
            </classpath>
        </javadoc>
    </target>

    <target name="jar-reladomo-graphql-javadoc" depends="reladomo-graphql-javadoc">
        <jar jarfile="${root}/target/reladomo-graphql-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomo/target/reladomographql-javadoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="gen-reladomo-pom" depends="init-reladomo">
        <generate-pom module="reladomo"/>
    </target>

    <target name="prep-reladomo" depends="gen-reladomo-pom, jar-reladomo, jar-reladomo-src, jar-reladomo-javadoc"/>

    <target name="jar-reladomo-test-util" depends="compile-reladomo-test-util">
        <jar jarfile="${root}/target/reladomo-test-util-${reladomo.version}.jar" index="true">
            <fileset dir="${root}/reladomo/target/test-util-classes">
                <include name="**/*"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-test-util-src" depends="init-reladomo">
        <jar jarfile="${root}/target/reladomo-test-util-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomo/src/test-util/java"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-test-util-javadoc" depends="reladomo-test-util-javadoc">
        <jar jarfile="${root}/target/reladomo-test-util-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomo/target/test-util-javadoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="gen-reladomo-test-util-pom" depends="init-reladomo">
        <generate-pom module="reladomo-test-util"/>
    </target>

    <target name="prep-reladomo-test-util" depends="gen-reladomo-test-util-pom, jar-reladomo-test-util, jar-reladomo-test-util-src, jar-reladomo-test-util-javadoc"/>

    <target name="jar-reladomo-gen-util" depends="compile-reladomo-genutil">
        <jar jarfile="${root}/target/reladomo-gen-util-${reladomo.version}.jar" index="true">
            <fileset dir="${root}/reladomogenutil/target/classes"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-gen-util-src" depends="init-reladomo">
        <jar jarfile="${root}/target/reladomo-gen-util-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomogenutil/src/main/java"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-gen-util-javadoc" depends="reladomo-gen-util-javadoc">
        <jar jarfile="${root}/target/reladomo-gen-util-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomogenutil/target/javadoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="gen-reladomo-gen-util-pom" depends="init-reladomo">
        <generate-pom module="reladomo-gen-util"/>
    </target>

    <target name="prep-reladomo-gen-util" depends="gen-reladomo-gen-util-pom, jar-reladomo-gen-util, jar-reladomo-gen-util-src, jar-reladomo-gen-util-javadoc"/>

    <target name="jar-reladomo-graphql" depends="compile-reladomo-graphql">
        <jar jarfile="${root}/target/reladomo-graphql-${reladomo.version}.jar" index="true">
            <fileset dir="${root}/reladomographql/target/classes"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-graphql-src" depends="init-reladomo">
        <jar jarfile="${root}/target/reladomo-graphql-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomographql/src/main/java"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="gen-reladomo-graphql-pom" depends="init-reladomo">
        <generate-pom module="reladomo-graphql"/>
    </target>

    <target name="prep-reladomo-graphql" depends="gen-reladomo-graphql-pom, jar-reladomo-graphql, jar-reladomo-graphql-src, jar-reladomo-graphql-javadoc"/>

    <target name="prep-release" depends="prep-reladomo, prep-reladomogen, prep-reladomo-gen-util, prep-reladomo-test-util, prep-reladomo-serial, prep-reladomo-xa, prep-reladomo-graphql"/>

    <target name="bundle-release" >
        <delete quiet="true" file="${root}/target/bundle-${reladomo.version}.jar"/>
        <dependset>
            <srcfileset dir="${root}/target">
                <include name="reladomo-${reladomo.version}.pom"/>
                <include name="reladomo-${reladomo.version}.jar"/>
                <include name="reladomo-${reladomo.version}-sources.jar"/>
                <include name="reladomo-${reladomo.version}-javadoc.jar"/>
                <include name="reladomogen-${reladomo.version}.pom"/>
                <include name="reladomogen-${reladomo.version}.jar"/>
                <include name="reladomogen-${reladomo.version}-sources.jar"/>
                <include name="reladomogen-${reladomo.version}-javadoc.jar"/>
                <include name="reladomo-gen-util-${reladomo.version}.pom"/>
                <include name="reladomo-gen-util-${reladomo.version}.jar"/>
                <include name="reladomo-gen-util-${reladomo.version}-sources.jar"/>
                <include name="reladomo-gen-util-${reladomo.version}-javadoc.jar"/>
                <include name="reladomo-test-util-${reladomo.version}.pom"/>
                <include name="reladomo-test-util-${reladomo.version}.jar"/>
                <include name="reladomo-test-util-${reladomo.version}-sources.jar"/>
                <include name="reladomo-test-util-${reladomo.version}-javadoc.jar"/>
                <include name="reladomo-serial-${reladomo.version}.pom"/>
                <include name="reladomo-serial-${reladomo.version}.jar"/>
                <include name="reladomo-serial-${reladomo.version}-sources.jar"/>
                <include name="reladomo-serial-${reladomo.version}-javadoc.jar"/>
                <include name="reladomo-xa-${reladomo.version}.pom"/>
                <include name="reladomo-xa-${reladomo.version}.jar"/>
                <include name="reladomo-xa-${reladomo.version}-sources.jar"/>
                <include name="reladomo-xa-${reladomo.version}-javadoc.jar"/>
                <include name="reladomo-graphql-${reladomo.version}.pom"/>
                <include name="reladomo-graphql-${reladomo.version}.jar"/>
                <include name="reladomo-graphql-${reladomo.version}-sources.jar"/>
                <include name="reladomo-graphql-${reladomo.version}-javadoc.jar"/>
            </srcfileset>
            <targetfileset dir="${root}/target" includes="*.asc"/>
        </dependset>
        <fail message="Release files are missing.">
            <condition>
                <not>
                    <resourcecount count="56">
                        <fileset dir="${root}/target">
                            <include name="reladomo-${reladomo.version}.pom"/>
                            <include name="reladomo-${reladomo.version}.jar"/>
                            <include name="reladomo-${reladomo.version}-sources.jar"/>
                            <include name="reladomo-${reladomo.version}-javadoc.jar"/>
                            <include name="reladomogen-${reladomo.version}.pom"/>
                            <include name="reladomogen-${reladomo.version}.jar"/>
                            <include name="reladomogen-${reladomo.version}-sources.jar"/>
                            <include name="reladomogen-${reladomo.version}-javadoc.jar"/>
                            <include name="reladomo-gen-util-${reladomo.version}.pom"/>
                            <include name="reladomo-gen-util-${reladomo.version}.jar"/>
                            <include name="reladomo-gen-util-${reladomo.version}-sources.jar"/>
                            <include name="reladomo-gen-util-${reladomo.version}-javadoc.jar"/>
                            <include name="reladomo-test-util-${reladomo.version}.pom"/>
                            <include name="reladomo-test-util-${reladomo.version}.jar"/>
                            <include name="reladomo-test-util-${reladomo.version}-sources.jar"/>
                            <include name="reladomo-test-util-${reladomo.version}-javadoc.jar"/>
                            <include name="reladomo-serial-${reladomo.version}.pom"/>
                            <include name="reladomo-serial-${reladomo.version}.jar"/>
                            <include name="reladomo-serial-${reladomo.version}-sources.jar"/>
                            <include name="reladomo-serial-${reladomo.version}-javadoc.jar"/>
                            <include name="reladomo-xa-${reladomo.version}.pom"/>
                            <include name="reladomo-xa-${reladomo.version}.jar"/>
                            <include name="reladomo-xa-${reladomo.version}-sources.jar"/>
                            <include name="reladomo-xa-${reladomo.version}-javadoc.jar"/>
                            <include name="reladomo-graphql-${reladomo.version}.pom"/>
                            <include name="reladomo-graphql-${reladomo.version}.jar"/>
                            <include name="reladomo-graphql-${reladomo.version}-sources.jar"/>
                            <include name="reladomo-graphql-${reladomo.version}-javadoc.jar"/>

                            <include name="reladomo-${reladomo.version}.pom.asc"/>
                            <include name="reladomo-${reladomo.version}.jar.asc"/>
                            <include name="reladomo-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomo-${reladomo.version}-javadoc.jar.asc"/>
                            <include name="reladomogen-${reladomo.version}.pom.asc"/>
                            <include name="reladomogen-${reladomo.version}.jar.asc"/>
                            <include name="reladomogen-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomogen-${reladomo.version}-javadoc.jar.asc"/>
                            <include name="reladomo-gen-util-${reladomo.version}.pom.asc"/>
                            <include name="reladomo-gen-util-${reladomo.version}.jar.asc"/>
                            <include name="reladomo-gen-util-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomo-gen-util-${reladomo.version}-javadoc.jar.asc"/>
                            <include name="reladomo-test-util-${reladomo.version}.pom.asc"/>
                            <include name="reladomo-test-util-${reladomo.version}.jar.asc"/>
                            <include name="reladomo-test-util-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomo-test-util-${reladomo.version}-javadoc.jar.asc"/>
                            <include name="reladomo-serial-${reladomo.version}.pom.asc"/>
                            <include name="reladomo-serial-${reladomo.version}.jar.asc"/>
                            <include name="reladomo-serial-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomo-serial-${reladomo.version}-javadoc.jar.asc"/>
                            <include name="reladomo-xa-${reladomo.version}.pom.asc"/>
                            <include name="reladomo-xa-${reladomo.version}.jar.asc"/>
                            <include name="reladomo-xa-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomo-xa-${reladomo.version}-javadoc.jar.asc"/>
                            <include name="reladomo-graphql-${reladomo.version}.pom.asc"/>
                            <include name="reladomo-graphql-${reladomo.version}.jar.asc"/>
                            <include name="reladomo-graphql-${reladomo.version}-sources.jar.asc"/>
                            <include name="reladomo-graphql-${reladomo.version}-javadoc.jar.asc"/>
                        </fileset>
                    </resourcecount>
                </not>
            </condition>
        </fail>
        <jar jarfile="${root}/target/bundle-reladomo-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomo-${reladomo.version}.pom"/>
                <include name="reladomo-${reladomo.version}.jar"/>
                <include name="reladomo-${reladomo.version}-sources.jar"/>
                <include name="reladomo-${reladomo.version}-javadoc.jar"/>

                <include name="reladomo-${reladomo.version}.pom.asc"/>
                <include name="reladomo-${reladomo.version}.jar.asc"/>
                <include name="reladomo-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomo-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
        <jar jarfile="${root}/target/bundle-reladomogen-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomogen-${reladomo.version}.pom"/>
                <include name="reladomogen-${reladomo.version}.jar"/>
                <include name="reladomogen-${reladomo.version}-sources.jar"/>
                <include name="reladomogen-${reladomo.version}-javadoc.jar"/>

                <include name="reladomogen-${reladomo.version}.pom.asc"/>
                <include name="reladomogen-${reladomo.version}.jar.asc"/>
                <include name="reladomogen-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomogen-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
        <jar jarfile="${root}/target/bundle-reladomo-gen-util-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomo-gen-util-${reladomo.version}.pom"/>
                <include name="reladomo-gen-util-${reladomo.version}.jar"/>
                <include name="reladomo-gen-util-${reladomo.version}-sources.jar"/>
                <include name="reladomo-gen-util-${reladomo.version}-javadoc.jar"/>

                <include name="reladomo-gen-util-${reladomo.version}.pom.asc"/>
                <include name="reladomo-gen-util-${reladomo.version}.jar.asc"/>
                <include name="reladomo-gen-util-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomo-gen-util-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
        <jar jarfile="${root}/target/bundle-reladomo-test-util-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomo-test-util-${reladomo.version}.pom"/>
                <include name="reladomo-test-util-${reladomo.version}.jar"/>
                <include name="reladomo-test-util-${reladomo.version}-sources.jar"/>
                <include name="reladomo-test-util-${reladomo.version}-javadoc.jar"/>

                <include name="reladomo-test-util-${reladomo.version}.pom.asc"/>
                <include name="reladomo-test-util-${reladomo.version}.jar.asc"/>
                <include name="reladomo-test-util-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomo-test-util-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
        <jar jarfile="${root}/target/bundle-reladomo-serial-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomo-serial-${reladomo.version}.pom"/>
                <include name="reladomo-serial-${reladomo.version}.jar"/>
                <include name="reladomo-serial-${reladomo.version}-sources.jar"/>
                <include name="reladomo-serial-${reladomo.version}-javadoc.jar"/>

                <include name="reladomo-serial-${reladomo.version}.pom.asc"/>
                <include name="reladomo-serial-${reladomo.version}.jar.asc"/>
                <include name="reladomo-serial-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomo-serial-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
        <jar jarfile="${root}/target/bundle-reladomo-xa-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomo-xa-${reladomo.version}.pom"/>
                <include name="reladomo-xa-${reladomo.version}.jar"/>
                <include name="reladomo-xa-${reladomo.version}-sources.jar"/>
                <include name="reladomo-xa-${reladomo.version}-javadoc.jar"/>

                <include name="reladomo-xa-${reladomo.version}.pom.asc"/>
                <include name="reladomo-xa-${reladomo.version}.jar.asc"/>
                <include name="reladomo-xa-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomo-xa-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
        <jar jarfile="${root}/target/bundle-reladomo-graphql-${reladomo.version}.jar" index="false">
            <fileset dir="${root}/target">
                <include name="reladomo-graphql-${reladomo.version}.pom"/>
                <include name="reladomo-graphql-${reladomo.version}.jar"/>
                <include name="reladomo-graphql-${reladomo.version}-sources.jar"/>
                <include name="reladomo-graphql-${reladomo.version}-javadoc.jar"/>

                <include name="reladomo-graphql-${reladomo.version}.pom.asc"/>
                <include name="reladomo-graphql-${reladomo.version}.jar.asc"/>
                <include name="reladomo-graphql-${reladomo.version}-sources.jar.asc"/>
                <include name="reladomo-graphql-${reladomo.version}-javadoc.jar.asc"/>
            </fileset>
        </jar>
    </target>

    <!-- ************************** /release opensource ***********************************-->

    <!-- ************************** reladomo gs ******************************* -->
    <target name="libboot-reladomogs">
        <libboot specFile="build/reladomogs.spec"/>
    </target>

    <target name="generate-reladomo-gsintegrator-classes" depends="compile-reladomo-generator, libboot-reladomogs">
        <taskdef name="reladomo-gen" classname="com.gs.fw.common.mithra.generator.MithraGenerator" loaderRef="mithraGenerator">
            <classpath refid="reladomogen.classpath"/>
        </taskdef>
        <reladomo-gen xml="${root}/reladomogsi/src/main/reladomo-xml/GsIntegratorClassList.xml"
            generatedDir="${root}/reladomogsi/target/generated-src"
            nonGeneratedDir="${root}/reladomogsi/src/main/java"
            generateConcreteClasses="${reladomo.generateConcreteClasses}"/>
    </target>

    <target name="check-compile-ui" depends="init-reladomo, libboot-reladomogs">
        <uptodate property="compile-ui.notRequired" targetfile="${gwt.compile.output.dir}/com.gs.fw.common.mithra.ui.gwt.MithraCacheUi/com.gs.fw.common.mithra.ui.gwt.MithraCacheUi.nocache.js" >
          <srcfiles dir= "${root}/reladomoui/src/main/java" includes="com/gs/fw/common/mithra/ui/**/*"/>
        </uptodate>
    </target>

    <target name="compile-reladomo-ui" depends="compile-reladomo, check-compile-ui" unless="compile-ui.notRequired">
        <dependset>
            <srcfileset dir="${root}/reladomoui/src/main/java"/>
            <srcfileset dir="${root}/reladomo/target/classes"/>
            <targetfileset dir="${root}/reladomoui/target/classes"/>
        </dependset>
        <javac destdir="${root}/reladomoui/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            includeAntRuntime="false">
            <src path="${root}/reladomoui/src/main/java"/>
            <classpath>
                <fileset refid="fileset.lib.ui"/>
                <fileset refid="fileset.lib.compile"/>
                <pathelement location="${root}/reladomo/target/classes"/>
            </classpath>
        </javac>
        <gwtcompile output="${gwt.compile.output.dir}" module="com.gs.fw.common.mithra.ui.gwt.MithraCacheUi"/>
    </target>

    <target name="jar-mithraui" depends="compile-reladomo-ui">
        <jar jarfile="${mithra.jars.dir}/mithraui-${reladomo.version}.jar" index="true">
            <fileset dir="${mithra.classes.dir}">
                <include name="com/gs/fw/common/mithra/ui/**/*.class"/>
            </fileset>
        </jar>
    </target>

    <target name="war-reladomo-ui" depends="compile-reladomo-ui">
        <war warfile="${root}/reladomoui/target/mithramiddletier.war" webxml="${root}/reladomoui/src/main/web/web.xml">
            <fileset dir="${root}/reladomoui/target/classes">
                <include name="**/*"/>
            </fileset>
            <fileset dir="${root}/reladomoui/src/main/web">
                <include name="image/**"/>
                <include name="MithraCache.html"/>
            </fileset>
        </war>
    </target>

    <target name="run-reladomo-gs-test-suite" depends="compile-reladomo-test" description="Run JUnit test cases for Reladomo code">
        <property name="jacocovmarg" value="-Dcoverage=none"/>
        <delete quiet="true" dir="${root}/reladomo/target/testresult"/>
        <mkdir dir="${root}/reladomo/target/testresult"/>
        <tstamp>
            <format property="TIME_NOW" pattern="hh:mm:ss a z"/>
        </tstamp>
        <echo message="JUnit master suite for Reladomo starting at ${TIME_NOW} on ${TODAY} "/>
        <echo message="Log4j file: ${root}/reladomo/src/test/resources/log4jWarn.config"/>
        <parallel threadsPerProcessor ="1" >
            <exec-test-suite mithraxmlconfig="MithraConfigGsIntegrator.xml" testclass="com.gs.fw.common.mithra.test.gsintegrator.TestGsIntegratorTransport" heap="onheap"/>
        </parallel>
    </target>

    <target name="get-cores">
        <property environment="env"/>
        <!-- support for Windows -->
        <condition property="cores.count" value="${env.NUMBER_OF_PROCESSORS}">
            <os family="windows" />
        </condition>
        <!-- support for Linux and Solaris (package SUNWgnu-coreutils is required) -->
        <exec executable="nproc" outputproperty="cores.count" os="Linux,SunOS,Solaris">
            <arg value="--all"/>
        </exec>
        <!-- support for Mac OS X -->
        <exec executable="sysctl" outputproperty="cores.count" osfamily="Mac">
            <arg value="-n"/>
            <arg value="hw.ncpu"/>
        </exec>
        <condition property="test.threads" value="${env.RELADOMO_TEST_THREADS}" else="${cores.count}">
            <isset property="env.RELADOMO_TEST_THREADS"/>
        </condition>
    </target>

    <target name="run-reladomo-vendor-test-suite" depends="compile-reladomo-test, get-cores" description="Run JUnit test cases for Reladomo code">
        <property name="jacocovmarg" value="-Dcoverage=none"/>
        <tstamp>
            <format property="TIME_NOW" pattern="hh:mm:ss a z"/>
        </tstamp>
        <echo message="JUnit master suite for Reladomo starting at ${TIME_NOW} on ${TODAY} with ${test.threads} jvms."/>
        <echo message="Log4j config: ${root}/reladomo/src/test/resources/log4jWarn.config"/>
        <parallel threadcount="${test.threads}" >
            <exec-test-suite mithraxmlconfig="MithraDb2TestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraDb2TestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraSybaseIqTestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraSybaseIqTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraOracleTestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraOracleTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraPostgresTestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraPostgresTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraMsSqlTestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraMsSqlTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraSybaseTestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraSybaseTestSuite" heap="onheap"/>
            <exec-test-suite mithraxmlconfig="MithraMariaTestConfig.xml" testclass="com.gs.fw.common.mithra.test.MithraMariaTestSuite" heap="onheap"/>
        </parallel>
    </target>

    <target name="reladomo-vendor-junitreport" if="junitHtmlReport" depends="run-reladomo-vendor-test-suite">
        <mkdir dir="${root}/reladomo/target/junit-report-vendor-test"/>
        <junitreport>
            <fileset dir="${root}/reladomo/target/testresult">
                <include name="TEST-*MithraDb2TestConfig.xml"/>
                <include name="TEST-*MithraMsSqlTestConfig.xml"/>
                <include name="TEST-*MithraSybaseTestConfig.xml"/>
                <include name="TEST-*MithraSybaseIqTestConfig.xml"/>
                <include name="TEST-*MithraPostgresTestConfig.xml"/>
                <include name="TEST-*MithraOracleTestConfig.xml"/>
                <include name="TEST-*MithraMariaTestConfig.xml"/>
            </fileset>
            <report format="frames" todir="${root}/reladomo/target/junit-report-vendor-test"/>
        </junitreport>
    </target>

    <target name="compile-reladomo-gs" depends="compile-reladomo, libboot-reladomogs, compile-reladomo-xa">
        <dependset>
            <srcfileset dir="${root}/reladomogs/src/main/java"/>
            <srcfileset dir="${root}/reladomo/target/classes"/>
            <targetfileset dir="${root}/reladomogs/target/classes"/>
        </dependset>
        <javac destdir="${root}/reladomogs/target/classes"
            debug="true"
            source="1.8"
            target="1.8"
            nowarn="true"
            includeAntRuntime="false">
            <src path="${root}/reladomogs/src/main/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <fileset refid="fileset.lib.gsapi"/>
                <path refid="reladomo.compile.classpath"/>
                <path refid="reladomo.xa.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomoxa/target/classes"/>
            </classpath>
        </javac>
    </target>

    <target name="jar-reladomo-gs" depends="compile-reladomo">
        <jar jarfile="${mithra.jars.dir}/mithragsi-${reladomo.version}.jar" index="true">
            <fileset dir="${mithra.classes.dir}">
                <include name="com/gs/fw/common/mithra/gsintegrator/**/*.class"/>
            </fileset>
        </jar>
    </target>

    <target name="jar-mithragsi" depends="compile-reladomo">
        <jar jarfile="${mithra.jars.dir}/mithragsi-${reladomo.version}.jar" index="true">
            <fileset dir="${mithra.classes.dir}">
                <include name="com/gs/fw/common/mithra/gsintegrator/**/*.class"/>
            </fileset>
        </jar>
    </target>
    <!-- ************************** /reladomo gs ******************************* -->

    <!-- ************************** reladomo serial ******************************* -->
    <fileset dir="${root}/lib/serial" id="fileset.lib.serial">
        <include name="**/*.jar"/>
    </fileset>

    <fileset dir="${root}/lib/serialtest" id="fileset.lib.serialtest">
        <include name="**/*.jar"/>
    </fileset>

    <path id="reladomo.serial.compile.classpath">
        <fileset refid="fileset.lib.serial"/>
        <path refid="reladomo.compile.classpath"/>
        <pathelement location="${root}/reladomo/target/classes"/>
    </path>

    <path id="reladomo.serial.test.compile.classpath">
        <path refid="reladomo.serial.compile.classpath"/>
        <path refid="reladomo.run.test.classpath"/>
        <fileset refid="fileset.lib.serialtest"/>
        <pathelement location="${root}/reladomoserial/target/classes"/>
        <pathelement location="${root}/reladomo/target/test-classes-onheap"/>
        <pathelement location="${root}/reladomo/target/test-util-classes"/>
    </path>

    <target name="init-reladomo-serial">
        <mkdir dir="${root}/reladomoserial/target"/>
        <mkdir dir="${root}/reladomoserial/target/classes"/>
        <mkdir dir="${root}/reladomoserial/target/javadoc"/>
        <mkdir dir="${root}/reladomoserial/target/test-classes"/>
        <mkdir dir="${root}/reladomoserial/target/testresult"/>
    </target>

    <target name="serial-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomoserial/src/main/java"/>
            <targetfileset dir="${root}/reladomoserial/target/classes"/>
        </dependset>
    </target>

    <target name="compile-reladomo-serial" depends="init-reladomo-serial, compile-reladomo, serial-dependset">
        <javac destdir="${root}/reladomoserial/target/classes"
               debug="true"
               source="1.8"
               target="1.8"
               nowarn="true"
               includeAntRuntime="false">
            <src path="${root}/reladomoserial/src/main/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.serial.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <target name="serial-test-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomoserial/src/test/java"/>
            <srcfileset dir="${root}/reladomoserial/target/classes"/>
            <targetfileset dir="${root}/reladomoserial/target/test-classes"/>
        </dependset>
    </target>

    <target name="compile-reladomo-serial-test" depends="compile-reladomo-serial, compile-reladomo-test, serial-test-dependset">
        <javac destdir="${root}/reladomoserial/target/test-classes"
               debug="true"
               source="1.8"
               target="1.8"
               nowarn="true"
               includeAntRuntime="false">
            <src path="${root}/reladomoserial/src/test/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.serial.test.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <macrodef name="exec-serial-test-suite">
        <attribute name="mithraxmlconfig" description="mithra.xml.config"/>
        <attribute name="testclass" description="test class"/>
        <attribute name="qualifier" description="added to the end of the test name" default=""/>
        <attribute name="heap" description="either 'onheap' or 'offheap"/>
        <sequential>
            <delete dir="${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
            <mkdir dir="${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
            <mkdir dir="${root}/reladomoserial/target/testresult"/>
            <junit printsummary="off" dir="${root}" timeout="3600000" fork="yes" failureproperty="failed.reladomo.serial.unit.tests"
                   includeantruntime="true" showoutput="false">
                <!--<formatter type="plain" usefile="false"/>-->
                <formatter type="xml" extension="@{mithraxmlconfig}"/>
                <formatter classname="com.gs.fw.common.mithra.test.JunitFormatter" extension="@{mithraxmlconfig}.txt"/>
                <classpath>
                    <path refid="reladomo.run.test.classpath"/>
                    <path refid="reladomo.serial.test.compile.classpath"/>
                    <pathelement location="${root}/reladomo/target/test-classes-@{heap}"/>
                    <pathelement location="${root}/reladomoserial/target/test-classes"/>
                </classpath>
                <jvmarg value="-server"/>
                <jvmarg value="${jacocovmarg}${root}/reladomo/target/coverage/@{mithraxmlconfig}@{testclass}@{heap}.exec"/>
                <jvmarg value="-Xmx3048m"/>
                <jvmarg value="-ea"/>
                <jvmarg value="-Dlog4j.configuration=file:${root}/reladomo/src/test/resources/log4jWarn.config"/>
                <jvmarg value="-Dmithra.xml.root=${root}/reladomo/src/test/resources/"/>
                <jvmarg value="-Dmithra.xml.config=@{mithraxmlconfig}"/>
                <jvmarg value="-Djacoco.args=${jacocovmarg}${root}/reladomo/target/coverage/@{mithraxmlconfig}@{testclass}@{heap}.exec"/>
                <jvmarg value="-Dderby.storage.tempDirectory=${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
                <jvmarg value="-Dderby.system.home=${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
                <jvmarg value="-Dderby.system.durability=test"/>
                <jvmarg value="-Duser.timezone=America/New_York"/>
                <test name="@{testclass}" todir="${root}/reladomoserial/target/testresult"/>
            </junit>
            <replace casesensitive="true" dir="${root}/reladomoserial/target/testresult" includes="TEST-@{testclass}@{mithraxmlconfig}">
                <replacefilter token="&quot; tests=" value="@{qualifier}&quot; tests="/>
            </replace>
            <replaceregexp file="${root}/reladomoserial/target/testresult/TEST-@{testclass}@{mithraxmlconfig}"
                           match="classname=&quot;(.*)\.([abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$1234567890]*)&quot; name=&quot;(.*)&quot; time"
                           replace="classname=&quot;\1.\2&quot; name=&quot;\2.\3@{qualifier}&quot; time"
                           byline="true"/>
        </sequential>
    </macrodef>

    <target name="run-reladomo-serial-test-suite" depends="compile-reladomo-serial-test, get-cores" description="Run JUnit test cases for Reladomo Serial code">
        <property name="jacocovmarg" value="-Dcoverage=none"/>
        <delete quiet="true" dir="${root}/reladomoserial/target/testresult"/>
        <mkdir dir="${root}/reladomoserial/target/testresult"/>
        <tstamp>
            <format property="TIME_NOW" pattern="hh:mm:ss a z"/>
        </tstamp>
        <echo message="JUnit serial suite for Reladomo starting at ${TIME_NOW} on ${TODAY} with ${test.threads} jvms."/>
        <echo message="Log4j file: ${root}/reladomo/src/test/resources/log4jWarn.config"/>
        <parallel threadcount="${test.threads}" >
            <exec-serial-test-suite mithraxmlconfig="MithraConfigFullCache.xml" qualifier="/full" testclass="com.gs.reladomo.serial.ReladomoSerialTestSuite" heap="onheap"/>
            <exec-serial-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.reladomo.serial.ReladomoSerialTestSuite" heap="onheap"/>
        </parallel>
    </target>

    <target name="reladomo-serial-junitreport" if="junitHtmlReport" depends="run-reladomo-serial-test-suite">
        <mkdir dir="${root}/reladomoserial/target/junit-report"/>
        <junitreport>
            <fileset dir="${root}/reladomoserial/target/testresult">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="noframes" todir="${root}/reladomoserial/target/junit-report"/>
        </junitreport>
    </target>

    <target name="reladomo-serial-test-suite" depends="reladomo-serial-junitreport" description="Run JUnit test cases for Reladomo serial code">
        <fail if="failed.reladomo.serial.unit.tests" message="Reladomo unit tests failed"/>
    </target>

    <target name="gen-reladomo-serial-pom" depends="init-reladomo-serial">
        <generate-pom module="reladomo-serial"/>
    </target>

    <target name="reladomo-serial-javadoc">
        <javadoc packagenames="com.gs.reladomo.*"
                 sourcepath="${root}/reladomoserial/src/main/java"
                 defaultexcludes="yes"
                 access="public"
                 destdir="${root}/reladomoserial/target/javadoc"
                 use="true"
                 windowtitle="Reladomo serial API"
                 version="yes"
                 Verbose="true">
            <classpath>
                <path refid="reladomogen.classpath"/>
                <path refid="reladomo.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomoserial/target/classes"/>
            </classpath>
        </javadoc>
    </target>

    <target name="jar-reladomo-serial" depends="compile-reladomo-serial">

        <jar jarfile="${root}/target/reladomo-serial-${reladomo.version}.jar" index="true">
            <manifest>
                <attribute name="Reladomo-Version" value="${reladomo.version}"/>
            </manifest>
            <fileset dir="${root}/reladomoserial/target/classes">
                <include name="**/*"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-serial-src" depends="compile-reladomo-serial">
        <jar jarfile="${root}/target/reladomo-serial-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomoserial/src/main/java">
                <include name="**/*.java"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-serial-javadoc" depends="reladomo-serial-javadoc">
        <jar jarfile="${root}/target/reladomo-serial-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomoserial/target/javadoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="prep-reladomo-serial" depends="gen-reladomo-serial-pom, jar-reladomo-serial, jar-reladomo-serial-src, jar-reladomo-serial-javadoc"/>
    <!-- ************************** /reladomo serial ******************************* -->

    <!-- ************************** reladomo xa ******************************* -->
    <fileset dir="${root}/lib/xa" id="fileset.lib.xa">
        <include name="**/*.jar"/>
    </fileset>

    <path id="reladomo.xa.compile.classpath">
        <fileset refid="fileset.lib.xa"/>
        <path refid="reladomo.compile.classpath"/>
        <pathelement location="${root}/reladomo/target/classes"/>
    </path>

    <path id="reladomo.xa.test.compile.classpath">
        <path refid="reladomo.xa.compile.classpath"/>
        <path refid="reladomo.run.test.classpath"/>
        <pathelement location="${root}/reladomoxa/src/test/resources"/>
        <pathelement location="${root}/reladomoxa/target/classes"/>
        <pathelement location="${root}/reladomo/target/test-classes-onheap"/>
        <pathelement location="${root}/reladomo/target/test-util-classes"/>
    </path>

    <target name="init-reladomo-xa">
        <mkdir dir="${root}/reladomoxa/target"/>
        <mkdir dir="${root}/reladomoxa/target/classes"/>
        <mkdir dir="${root}/reladomoxa/target/javadoc"/>
        <mkdir dir="${root}/reladomoxa/target/test-classes"/>
        <mkdir dir="${root}/reladomoxa/target/testresult"/>
    </target>

    <target name="xa-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomoxa/src/main/java"/>
            <targetfileset dir="${root}/reladomoxa/target/classes"/>
        </dependset>
    </target>

    <target name="compile-reladomo-xa" depends="init-reladomo-xa, compile-reladomo, xa-dependset">
        <javac destdir="${root}/reladomoxa/target/classes"
               debug="true"
               source="1.8"
               target="1.8"
               nowarn="true"
               includeAntRuntime="false">
            <src path="${root}/reladomoxa/src/main/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.xa.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <target name="xa-test-dependset" unless="${unsafeCompile}">
        <dependset>
            <srcfileset dir="${root}/reladomoxa/src/test/java"/>
            <srcfileset dir="${root}/reladomoxa/target/classes"/>
            <targetfileset dir="${root}/reladomoxa/target/test-classes"/>
        </dependset>
    </target>

    <target name="compile-reladomo-xa-test" depends="compile-reladomo-xa, compile-reladomo-test, xa-test-dependset">
        <javac destdir="${root}/reladomoxa/target/test-classes"
               debug="true"
               source="1.8"
               target="1.8"
               nowarn="true"
               includeAntRuntime="false">
            <src path="${root}/reladomoxa/src/test/java"/>
            <compilerarg line="-Xlint:-unchecked -Xlint:-deprecation -XDignore.symbol.file"/>
            <classpath>
                <path refid="reladomo.xa.test.compile.classpath"/>
            </classpath>
        </javac>
    </target>

    <macrodef name="exec-xa-test-suite">
        <attribute name="mithraxmlconfig" description="mithra.xml.config"/>
        <attribute name="testclass" description="test class"/>
        <attribute name="qualifier" description="added to the end of the test name" default=""/>
        <attribute name="heap" description="either 'onheap' or 'offheap"/>
        <sequential>
            <delete dir="${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
            <mkdir dir="${root}/reladomo/target/dbtemp/@{mithraxmlconfig}@{testclass}"/>
            <mkdir dir="${root}/reladomoxa/target/testresult"/>
            <junit printsummary="off" dir="${root}" timeout="3600000" fork="yes" failureproperty="failed.reladomo.xa.unit.tests"
                   includeantruntime="true" showoutput="false">
                <!--<formatter type="plain" usefile="false"/>-->
                <formatter type="xml" extension="@{mithraxmlconfig}"/>
                <formatter classname="com.gs.fw.common.mithra.test.JunitFormatter" extension="@{mithraxmlconfig}.txt"/>
                <classpath>
                    <path refid="reladomo.run.test.classpath"/>
                    <path refid="reladomo.xa.test.compile.classpath"/>
                    <pathelement location="${root}/reladomo/target/test-classes-@{heap}"/>
                    <pathelement location="${root}/reladomoxa/target/test-classes"/>
                </classpath>
                <jvmarg value="-server"/>
                <jvmarg value="${jacocovmarg}${root}/reladomoxa/target/coverage/@{mithraxmlconfig}@{testclass}@{heap}.exec"/>
                <jvmarg value="-Xmx3048m"/>
                <jvmarg value="-ea"/>
                <jvmarg value="-Dlog4j.configuration=file:${root}/reladomo/src/test/resources/log4jWarn.config"/>
                <jvmarg value="-Djacoco.args=${jacocovmarg}${root}/reladomoxa/target/coverage/@{mithraxmlconfig}@{testclass}@{heap}.exec"/>
                <jvmarg value="-Duser.timezone=America/New_York"/>
                <test name="@{testclass}" todir="${root}/reladomoxa/target/testresult"/>
            </junit>
            <replace casesensitive="true" dir="${root}/reladomoxa/target/testresult" includes="TEST-@{testclass}@{mithraxmlconfig}">
                <replacefilter token="&quot; tests=" value="@{qualifier}&quot; tests="/>
            </replace>
            <replaceregexp file="${root}/reladomoxa/target/testresult/TEST-@{testclass}@{mithraxmlconfig}"
                           match="classname=&quot;(.*)\.([abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$1234567890]*)&quot; name=&quot;(.*)&quot; time"
                           replace="classname=&quot;\1.\2&quot; name=&quot;\2.\3@{qualifier}&quot; time"
                           byline="true"/>
        </sequential>
    </macrodef>

    <target name="run-reladomo-xa-test-suite" depends="compile-reladomo-xa-test, get-cores" description="Run JUnit test cases for Reladomo xa code">
        <property name="jacocovmarg" value="-Dcoverage=none"/>
        <delete quiet="true" dir="${root}/reladomoxa/target/testresult"/>
        <mkdir dir="${root}/reladomoxa/target/testresult"/>
        <tstamp>
            <format property="TIME_NOW" pattern="hh:mm:ss a z"/>
        </tstamp>
        <echo message="JUnit xa suite for Reladomo starting at ${TIME_NOW} on ${TODAY} with ${test.threads} jvms."/>
        <echo message="Log4j file: ${root}/reladomo/src/test/resources/log4jWarn.config"/>
        <parallel threadcount="${test.threads}" >
            <exec-xa-test-suite mithraxmlconfig="MithraConfigPartialCache.xml" qualifier="/partial" testclass="com.gs.reladomo.jms.ReladomoJmsTestSuite" heap="onheap"/>
        </parallel>
    </target>

    <target name="gen-reladomo-xa-pom" depends="init-reladomo-xa">
        <generate-pom module="reladomo-xa"/>
    </target>

    <target name="reladomo-xa-javadoc">
        <javadoc packagenames="com.gs.reladomo.*"
                 sourcepath="${root}/reladomoxa/src/main/java"
                 defaultexcludes="yes"
                 access="public"
                 destdir="${root}/reladomoxa/target/javadoc"
                 use="true"
                 windowtitle="Reladomo xa API"
                 version="yes"
                 Verbose="true">
            <classpath>
                <path refid="reladomogen.classpath"/>
                <path refid="reladomo.compile.classpath"/>
                <path refid="reladomo.xa.compile.classpath"/>
                <pathelement location="${root}/reladomo/target/classes"/>
                <pathelement location="${root}/reladomoxa/target/classes"/>
            </classpath>
        </javadoc>
    </target>

    <target name="reladomo-xa-junitreport" if="junitHtmlReport" depends="run-reladomo-xa-test-suite">
        <mkdir dir="${root}/reladomoxa/target/junit-report"/>
        <junitreport>
            <fileset dir="${root}/reladomoxa/target/testresult">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="noframes" todir="${root}/reladomoxa/target/junit-report"/>
        </junitreport>
    </target>

    <target name="reladomo-xa-test-suite" depends="reladomo-xa-junitreport" description="Run JUnit test cases for Reladomo XA code">
        <fail if="failed.reladomo.xa.unit.tests" message="Reladomo unit tests failed"/>
    </target>

    <target name="jar-reladomo-xa" depends="compile-reladomo-xa">

        <jar jarfile="${root}/target/reladomo-xa-${reladomo.version}.jar" index="true">
            <manifest>
                <attribute name="Reladomo-Version" value="${reladomo.version}"/>
            </manifest>
            <fileset dir="${root}/reladomoxa/target/classes">
                <include name="**/*"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-xa-src" depends="compile-reladomo-xa">
        <jar jarfile="${root}/target/reladomo-xa-${reladomo.version}-sources.jar" index="true">
            <fileset dir="${root}/reladomoxa/src/main/java">
                <include name="**/*.java"/>
            </fileset>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="jar-reladomo-xa-javadoc" depends="reladomo-xa-javadoc">
        <jar jarfile="${root}/target/reladomo-xa-${reladomo.version}-javadoc.jar" index="true">
            <fileset dir="${root}/reladomoxa/target/javadoc"/>
            <zipfileset prefix="META-INF" file="${root}/NOTICE.txt"/>
            <zipfileset prefix="META-INF" file="${root}/LICENSE.txt"/>
        </jar>
    </target>

    <target name="prep-reladomo-xa" depends="gen-reladomo-xa-pom, jar-reladomo-xa, jar-reladomo-xa-src, jar-reladomo-xa-javadoc"/>
    <!-- ************************** /reladomo xa ******************************* -->

    <target name="reladomo-test-suite-extra" depends="reladomo-serial-test-suite, run-reladomo-graphql-test-suite, reladomo-xa-test-suite"/>

</project>
